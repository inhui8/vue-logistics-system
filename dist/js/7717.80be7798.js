"use strict";(self["webpackChunkvue_logistics_system"]=self["webpackChunkvue_logistics_system"]||[]).push([[7717],{7717:(e,a,l)=>{l.r(a),l.d(a,{default:()=>c});var t=l(641),n=l(3751),o=l(33),d=l(953);const s={class:"app-container"},i={key:1},u={style:{"white-space":"pre-wrap","word-break":"break-all","max-height":"60vh","overflow-y":"auto"}},r={__name:"EmailLog",setup(e){const a=(0,d.KR)(!0),l=(0,d.KR)([]),r=(0,d.KR)(0),m=(0,d.KR)(null),p=(0,d.KR)([]),c=(0,d.KR)(!1),g=(0,d.KR)(""),b=(0,d.Kh)({pageNo:1,pageSize:10,toMail:void 0,accountId:void 0,templateCode:void 0,sendStatus:void 0,sendTimeRange:[]}),k=()=>{p.value=[{value:1,label:"sender1@example.com"},{value:2,label:"sender2@example.com"},{value:3,label:"no-ssl@example.com"},{value:4,label:"another@domain.net"}]},v=()=>{a.value=!0;const e={...b};e.sendTimeRange&&2===e.sendTimeRange.length&&(e.beginSendTime=e.sendTimeRange[0],e.endSendTime=e.sendTimeRange[1]),delete e.sendTimeRange,console.log("Fetching log list with params:",e),setTimeout((()=>{const t=[{id:1001,userId:1,userType:1,toMail:"user1@test.com",accountId:1,fromMail:"sender1@example.com",templateId:101,templateCode:"ORDER_CONFIRM",templateTitle:"您的订单 {orderNo} 已确认",templateContent:"尊敬的 {customerName}，您的订单 {orderNo} 已确认，感谢您的购买！",templateParams:'{"customerName": "测试用户A", "orderNo": "ORD1001"}',sendStatus:0,sendTime:new Date(Date.now()-36e5),messageId:"msg-111",exceptionMessage:null},{id:1002,userId:2,userType:1,toMail:"user2@test.com",accountId:2,fromMail:"sender2@example.com",templateId:102,templateCode:"PASSWORD_RESET",templateTitle:"密码重置请求",templateContent:"请点击以下链接重置您的密码：{resetLink}",templateParams:'{"resetLink": "http://example.com/reset?token=abc"}',sendStatus:0,sendTime:new Date(Date.now()-72e5),messageId:"msg-222",exceptionMessage:null},{id:1003,userId:3,userType:2,toMail:"admin@test.com",accountId:1,fromMail:"sender1@example.com",templateId:103,templateCode:"PROMOTION_NEWS",templateTitle:"最新优惠活动！",templateContent:"亲爱的用户，我们有新的优惠活动，详情请见：{promoLink}",templateParams:'{"promoLink": "http://example.com/promo"}',sendStatus:1,sendTime:new Date(Date.now()-108e5),messageId:"msg-333",exceptionMessage:"ConnectException: Connection refused"},{id:1004,userId:1,userType:1,toMail:"user1_again@test.com",accountId:4,fromMail:"another@domain.net",templateId:101,templateCode:"ORDER_CONFIRM",templateTitle:"您的订单 {orderNo} 已确认",templateContent:"尊敬的 {customerName}，您的订单 {orderNo} 已确认，感谢您的购买！",templateParams:'{"customerName": "测试用户B", "orderNo": "ORD1004"}',sendStatus:0,sendTime:new Date(Date.now()-144e5),messageId:"msg-444",exceptionMessage:null}];let n=t.filter((a=>{let l=!0;return e.toMail&&!a.toMail.includes(e.toMail)&&(l=!1),e.accountId&&a.accountId!==e.accountId&&(l=!1),e.templateCode&&!a.templateCode.includes(e.templateCode)&&(l=!1),void 0!==e.sendStatus&&a.sendStatus!==e.sendStatus&&(l=!1),e.beginSendTime&&new Date(a.sendTime)<new Date(e.beginSendTime)&&(l=!1),e.endSendTime&&new Date(a.sendTime)>new Date(e.endSendTime)&&(l=!1),l}));const o=(e.pageNo-1)*e.pageSize,d=o+e.pageSize;l.value=n.slice(o,d),r.value=n.length,a.value=!1}),500)},f=()=>{b.pageNo=1,v()},w=()=>{m.value?.resetFields(),f()},_=e=>{g.value=e,c.value=!0};return(0,t.sV)((()=>{v(),k()})),(e,d)=>{const k=(0,t.g2)("el-input"),h=(0,t.g2)("el-form-item"),F=(0,t.g2)("el-option"),C=(0,t.g2)("el-select"),T=(0,t.g2)("el-date-picker"),S=(0,t.g2)("el-button"),y=(0,t.g2)("el-form"),I=(0,t.g2)("el-card"),R=(0,t.g2)("el-table-column"),M=(0,t.g2)("el-tag"),x=(0,t.g2)("el-table"),D=(0,t.g2)("el-pagination"),N=(0,t.g2)("el-dialog"),V=(0,t.gN)("loading");return(0,t.uX)(),(0,t.CE)("div",s,[(0,t.bF)(I,{shadow:"never"},{default:(0,t.k6)((()=>[(0,t.bF)(y,{model:b,ref_key:"queryFormRef",ref:m,inline:!0,"label-width":"68px"},{default:(0,t.k6)((()=>[(0,t.bF)(h,{label:"收件邮箱",prop:"toMail"},{default:(0,t.k6)((()=>[(0,t.bF)(k,{modelValue:b.toMail,"onUpdate:modelValue":d[0]||(d[0]=e=>b.toMail=e),placeholder:"请输入收件邮箱",clearable:"",onKeyup:(0,n.jR)(f,["enter"])},null,8,["modelValue"])])),_:1}),(0,t.bF)(h,{label:"发送账号",prop:"accountId"},{default:(0,t.k6)((()=>[(0,t.bF)(C,{modelValue:b.accountId,"onUpdate:modelValue":d[1]||(d[1]=e=>b.accountId=e),placeholder:"请选择发送账号",clearable:"",style:{width:"240px"}},{default:(0,t.k6)((()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(p.value,(e=>((0,t.uX)(),(0,t.Wv)(F,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,t.bF)(h,{label:"模板编码",prop:"templateCode"},{default:(0,t.k6)((()=>[(0,t.bF)(k,{modelValue:b.templateCode,"onUpdate:modelValue":d[2]||(d[2]=e=>b.templateCode=e),placeholder:"请输入模板编码",clearable:"",onKeyup:(0,n.jR)(f,["enter"])},null,8,["modelValue"])])),_:1}),(0,t.bF)(h,{label:"发送状态",prop:"sendStatus"},{default:(0,t.k6)((()=>[(0,t.bF)(C,{modelValue:b.sendStatus,"onUpdate:modelValue":d[3]||(d[3]=e=>b.sendStatus=e),placeholder:"请选择发送状态",clearable:"",style:{width:"240px"}},{default:(0,t.k6)((()=>[(0,t.bF)(F,{label:"发送成功",value:0}),(0,t.bF)(F,{label:"发送失败",value:1})])),_:1},8,["modelValue"])])),_:1}),(0,t.bF)(h,{label:"发送时间",prop:"sendTimeRange"},{default:(0,t.k6)((()=>[(0,t.bF)(T,{modelValue:b.sendTimeRange,"onUpdate:modelValue":d[4]||(d[4]=e=>b.sendTimeRange=e),type:"datetimerange","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"240px"}},null,8,["modelValue"])])),_:1}),(0,t.bF)(h,null,{default:(0,t.k6)((()=>[(0,t.bF)(S,{type:"primary",icon:"el-icon-search",onClick:f},{default:(0,t.k6)((()=>d[9]||(d[9]=[(0,t.eW)("搜索")]))),_:1}),(0,t.bF)(S,{icon:"el-icon-refresh",onClick:w},{default:(0,t.k6)((()=>d[10]||(d[10]=[(0,t.eW)("重置")]))),_:1})])),_:1})])),_:1},8,["model"])])),_:1}),(0,t.bF)(I,{shadow:"never",class:"mt-4"},{default:(0,t.k6)((()=>[(0,t.bo)(((0,t.uX)(),(0,t.Wv)(x,{data:l.value},{default:(0,t.k6)((()=>[(0,t.bF)(R,{label:"编号",align:"center",prop:"id",width:"80"}),(0,t.bF)(R,{label:"发送邮箱账号",align:"center",prop:"fromMail",width:"180"}),(0,t.bF)(R,{label:"收件邮箱",align:"center",prop:"toMail",width:"180"}),(0,t.bF)(R,{label:"模板标题",align:"center",prop:"templateTitle","show-overflow-tooltip":""}),(0,t.bF)(R,{label:"发送内容",align:"center"},{default:(0,t.k6)((e=>[(0,t.bF)(S,{link:"",type:"primary",onClick:a=>_(e.row.templateContent)},{default:(0,t.k6)((()=>d[11]||(d[11]=[(0,t.eW)("查看")]))),_:2},1032,["onClick"])])),_:1}),(0,t.bF)(R,{label:"发送参数",align:"center"},{default:(0,t.k6)((e=>[(0,t.bF)(S,{link:"",type:"primary",onClick:a=>_(e.row.templateParams)},{default:(0,t.k6)((()=>d[12]||(d[12]=[(0,t.eW)("查看")]))),_:2},1032,["onClick"])])),_:1}),(0,t.bF)(R,{label:"发送状态",align:"center",width:"100"},{default:(0,t.k6)((e=>[(0,t.bF)(M,{type:0===e.row.sendStatus?"success":"danger"},{default:(0,t.k6)((()=>[(0,t.eW)((0,o.v_)(0===e.row.sendStatus?"成功":"失败"),1)])),_:2},1032,["type"])])),_:1}),(0,t.bF)(R,{label:"模板编号",align:"center",prop:"templateId",width:"100"}),(0,t.bF)(R,{label:"消息编号",align:"center",prop:"messageId",width:"100"}),(0,t.bF)(R,{label:"发送时间",align:"center",prop:"sendTime",width:"180"},{default:(0,t.k6)((e=>[(0,t.Lk)("span",null,(0,o.v_)(e.row.sendTime?new Date(e.row.sendTime).toLocaleString():""),1)])),_:1}),(0,t.bF)(R,{label:"异常信息",align:"center"},{default:(0,t.k6)((e=>[1===e.row.sendStatus?((0,t.uX)(),(0,t.Wv)(S,{key:0,link:"",type:"danger",onClick:a=>_(e.row.exceptionMessage)},{default:(0,t.k6)((()=>d[13]||(d[13]=[(0,t.eW)(" 查看 ")]))),_:2},1032,["onClick"])):((0,t.uX)(),(0,t.CE)("span",i,"-"))])),_:1})])),_:1},8,["data"])),[[V,a.value]]),(0,t.bo)((0,t.bF)(D,{"current-page":b.pageNo,"onUpdate:currentPage":d[5]||(d[5]=e=>b.pageNo=e),"page-size":b.pageSize,"onUpdate:pageSize":d[6]||(d[6]=e=>b.pageSize=e),total:r.value,"page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:v,onCurrentChange:v,class:"mt-4 justify-end"},null,8,["current-page","page-size","total"]),[[n.aG,r.value>0]])])),_:1}),(0,t.bF)(N,{title:"查看详情",modelValue:c.value,"onUpdate:modelValue":d[8]||(d[8]=e=>c.value=e),width:"700px","append-to-body":""},{footer:(0,t.k6)((()=>[(0,t.bF)(S,{onClick:d[7]||(d[7]=e=>c.value=!1)},{default:(0,t.k6)((()=>d[14]||(d[14]=[(0,t.eW)("关 闭")]))),_:1})])),default:(0,t.k6)((()=>[(0,t.Lk)("div",u,(0,o.v_)(g.value),1)])),_:1},8,["modelValue"])])}}};var m=l(6262);const p=(0,m.A)(r,[["__scopeId","data-v-f28122ce"]]),c=p}}]);
//# sourceMappingURL=7717.80be7798.js.map