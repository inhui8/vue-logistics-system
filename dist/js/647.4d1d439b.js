"use strict";(self["webpackChunkvue_logistics_system"]=self["webpackChunkvue_logistics_system"]||[]).push([[647],{2647:(e,l,a)=>{a.r(l),a.d(l,{default:()=>m});var i=a(641),t=a(953),o=a(33),d=a(163),r=a(7918),n=a(8548);const u={class:"contract-template-container"},p={class:"card-header"},s={class:"dialog-footer"},c={__name:"ContractTemplateManagement",setup(e){const l=(0,t.KR)([]),a=[{value:"framework",label:"年度框架协议"},{value:"transport",label:"单次运输合同"},{value:"warehouse",label:"仓储服务合同"},{value:"nda",label:"保密协议"},{value:"other",label:"其他"}],c=()=>{const e=[{id:"tpl_1",name:"年度运输框架协议模板",type:"framework",version:"V2.1",uploader:"法务部A",uploadTime:"2024-03-15 10:30:00",fileUrl:"/path/to/template1_v2.1.docx",fileSize:122880,versions:[{id:"tpl_1_v2.1",version:"V2.1",uploader:"法务部A",uploadTime:"2024-03-15 10:30:00",fileSize:122880,fileUrl:"/path/to/template1_v2.1.docx"},{id:"tpl_1_v2.0",version:"V2.0",uploader:"法务部A",uploadTime:"2024-01-10 14:00:00",fileSize:117760,fileUrl:"/path/to/template1_v2.0.docx"},{id:"tpl_1_v1.0",version:"V1.0",uploader:"张三",uploadTime:"2023-05-20 09:00:00",fileSize:102400,fileUrl:"/path/to/template1_v1.0.docx"}]},{id:"tpl_2",name:"标准仓储服务合同模板",type:"warehouse",version:"V1.0",uploader:"仓库主管B",uploadTime:"2024-02-01 16:00:00",fileUrl:"/path/to/template2_v1.0.pdf",fileSize:87040,versions:[{id:"tpl_2_v1.0",version:"V1.0",uploader:"仓库主管B",uploadTime:"2024-02-01 16:00:00",fileSize:87040,fileUrl:"/path/to/template2_v1.0.pdf"}]},{id:"tpl_3",name:"运输服务保密协议",type:"nda",version:"V1.1",uploader:"法务部A",uploadTime:"2024-04-10 11:00:00",fileUrl:"/path/to/template3_v1.1.docx",fileSize:61440,versions:[{id:"tpl_3_v1.1",version:"V1.1",uploader:"法务部A",uploadTime:"2024-04-10 11:00:00",fileSize:61440,fileUrl:"/path/to/template3_v1.1.docx"},{id:"tpl_3_v1.0",version:"V1.0",uploader:"法务部A",uploadTime:"2023-11-01 15:20:00",fileSize:59392,fileUrl:"/path/to/template3_v1.0.docx"}]}];l.value=e.sort(((e,l)=>new Date(l.uploadTime)-new Date(e.uploadTime)))},v=(0,t.KR)(!1),f=(0,t.KR)(null),m=(0,t.KR)(null),b=(0,t.KR)(!1),_={name:"",type:"",version:"",fileList:[],selectedFile:null},k=(0,t.Kh)({..._}),F=(0,t.Kh)({name:[{required:!0,message:"请输入模板名称",trigger:"blur"}],type:[{required:!0,message:"请选择适用类型",trigger:"change"}],version:[{required:!0,message:"请输入版本号",trigger:"blur"}],file:[{required:!0,message:"请选择要上传的文件"}]}),h=(0,t.KR)(!1),g=(0,t.KR)(null),w=e=>a.find((l=>l.value===e))?.label||e,y=()=>{v.value=!0},V=()=>{Object.assign(k,_),k.fileList=[],k.selectedFile=null,m.value?.clearFiles(),f.value?.clearValidate()},z=e=>{m.value.clearFiles();const l=e[0];l.uid=Date.now()+Math.random(),m.value.handleStart(l),d.nk.warning("只能上传一个文件，已替换为最新选择的文件")},x=(e,l)=>{console.log("File selected:",e),"ready"===e.status?(k.selectedFile=e,f.value?.validateField("file")):0===l.length&&(k.selectedFile=null,f.value?.validateField("file")),k.fileList=l},S=async()=>{if(f.value){if(!k.selectedFile)return F.file[0].required=!0,f.value?.validateField("file"),void d.nk.error("请选择要上传的模板文件");F.file[0].required=!1,f.value?.clearValidate("file");try{await f.value.validate(),b.value=!0;const e=k.selectedFile;console.log("开始上传模板:",{name:k.name,type:k.type,version:k.version,fileName:e.name,fileSize:e.size}),setTimeout((()=>{const a={id:`tpl_${Date.now()}`,name:k.name,type:k.type,version:k.version,uploader:"当前用户",uploadTime:(new Date).toLocaleString(),fileUrl:`/mock/path/${e.uid}/${e.name}`,fileSize:e.size,versions:[{id:`tpl_ver_${Date.now()}`,version:k.version,uploader:"当前用户",uploadTime:(new Date).toLocaleString(),fileSize:e.size,fileUrl:`/mock/path/${e.uid}/${e.name}`}]};l.value.unshift(a),l.value.sort(((e,l)=>new Date(l.uploadTime)-new Date(e.uploadTime))),b.value=!1,v.value=!1,d.nk.success("模板上传成功")}),1500)}catch(e){console.log("表单验证失败:",e),d.nk.error("请检查表单信息是否完整")}}},T=e=>{console.log(`下载模板: ${e.name} (版本: ${e.version}), URL: ${e.fileUrl}`),d.nk.success(`开始下载模板 ${e.name} ${e.version} (模拟)`)},U=e=>{g.value=JSON.parse(JSON.stringify(e)),h.value=!0},C=e=>{r.s.confirm(`确定要删除模板 "${e.name}" (版本: ${e.version}) 吗? 这将删除所有历史版本。`,"确认删除",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning"}).then((()=>{console.log("删除模板:",e.id);const a=l.value.findIndex((l=>l.id===e.id));-1!==a?(l.value.splice(a,1),d.nk.success("模板已删除")):d.nk.error("删除失败: 未找到模板")})).catch((()=>{}))};return(0,i.sV)((()=>{c()})),(e,d)=>{const r=(0,i.g2)("el-icon"),c=(0,i.g2)("el-button"),_=(0,i.g2)("el-table-column"),R=(0,i.g2)("el-table"),L=(0,i.g2)("el-input"),$=(0,i.g2)("el-form-item"),K=(0,i.g2)("el-option"),W=(0,i.g2)("el-select"),D=(0,i.g2)("el-upload"),A=(0,i.g2)("el-form"),q=(0,i.g2)("el-dialog"),B=(0,i.g2)("el-card");return(0,i.uX)(),(0,i.CE)("div",u,[(0,i.bF)(B,null,{header:(0,i.k6)((()=>[(0,i.Lk)("div",p,[d[9]||(d[9]=(0,i.Lk)("span",null,"合同模板管理",-1)),(0,i.bF)(c,{type:"primary",onClick:y},{default:(0,i.k6)((()=>[(0,i.bF)(r,null,{default:(0,i.k6)((()=>[(0,i.bF)((0,t.R1)(n._OO))])),_:1}),d[8]||(d[8]=(0,i.eW)(" 上传新模板 "))])),_:1})])])),default:(0,i.k6)((()=>[(0,i.bF)(R,{data:l.value,style:{width:"100%"},border:""},{default:(0,i.k6)((()=>[(0,i.bF)(_,{prop:"name",label:"模板名称","min-width":"200","show-overflow-tooltip":""}),(0,i.bF)(_,{prop:"type",label:"适用类型",width:"150"},{default:(0,i.k6)((e=>[(0,i.eW)((0,o.v_)(w(e.row.type)),1)])),_:1}),(0,i.bF)(_,{prop:"version",label:"版本号",width:"100",align:"center"}),(0,i.bF)(_,{prop:"uploader",label:"上传人",width:"120"}),(0,i.bF)(_,{prop:"uploadTime",label:"上传时间",width:"160",sortable:""}),(0,i.bF)(_,{prop:"fileSize",label:"文件大小",width:"120",align:"right"},{default:(0,i.k6)((e=>[(0,i.eW)((0,o.v_)((e.row.fileSize/1024).toFixed(1))+" KB",1)])),_:1}),(0,i.bF)(_,{label:"操作",fixed:"right",width:"220"},{default:(0,i.k6)((e=>[(0,i.bF)(c,{text:"",type:"primary",size:"small",icon:(0,t.R1)(n.f5X),onClick:l=>T(e.row)},{default:(0,i.k6)((()=>d[10]||(d[10]=[(0,i.eW)("下载")]))),_:2},1032,["icon","onClick"]),(0,i.bF)(c,{text:"",type:"info",size:"small",icon:(0,t.R1)(n.e7F),onClick:l=>U(e.row)},{default:(0,i.k6)((()=>d[11]||(d[11]=[(0,i.eW)("历史版本")]))),_:2},1032,["icon","onClick"]),(0,i.bF)(c,{text:"",type:"danger",size:"small",icon:(0,t.R1)(n.epd),onClick:l=>C(e.row)},{default:(0,i.k6)((()=>d[12]||(d[12]=[(0,i.eW)("删除")]))),_:2},1032,["icon","onClick"])])),_:1})])),_:1},8,["data"]),(0,i.bF)(q,{modelValue:v.value,"onUpdate:modelValue":d[5]||(d[5]=e=>v.value=e),title:"上传新模板",width:"500px","close-on-click-modal":!1,onClose:V},{footer:(0,i.k6)((()=>[(0,i.Lk)("span",s,[(0,i.bF)(c,{onClick:d[4]||(d[4]=e=>v.value=!1)},{default:(0,i.k6)((()=>d[15]||(d[15]=[(0,i.eW)("取消")]))),_:1}),(0,i.bF)(c,{type:"primary",onClick:S,loading:b.value},{default:(0,i.k6)((()=>d[16]||(d[16]=[(0,i.eW)("确认上传")]))),_:1},8,["loading"])])])),default:(0,i.k6)((()=>[(0,i.bF)(A,{ref_key:"uploadFormRef",ref:f,model:k,rules:F,"label-width":"100px"},{default:(0,i.k6)((()=>[(0,i.bF)($,{label:"模板名称",prop:"name"},{default:(0,i.k6)((()=>[(0,i.bF)(L,{modelValue:k.name,"onUpdate:modelValue":d[0]||(d[0]=e=>k.name=e),placeholder:"例如：年度框架协议模板"},null,8,["modelValue"])])),_:1}),(0,i.bF)($,{label:"适用类型",prop:"type"},{default:(0,i.k6)((()=>[(0,i.bF)(W,{modelValue:k.type,"onUpdate:modelValue":d[1]||(d[1]=e=>k.type=e),placeholder:"选择模板适用的合同类型",style:{width:"100%"}},{default:(0,i.k6)((()=>[((0,i.uX)(),(0,i.CE)(i.FK,null,(0,i.pI)(a,(e=>(0,i.bF)(K,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),64))])),_:1},8,["modelValue"])])),_:1}),(0,i.bF)($,{label:"版本号",prop:"version"},{default:(0,i.k6)((()=>[(0,i.bF)(L,{modelValue:k.version,"onUpdate:modelValue":d[2]||(d[2]=e=>k.version=e),placeholder:"例如：V1.0"},null,8,["modelValue"])])),_:1}),(0,i.bF)($,{label:"选择文件",prop:"file"},{default:(0,i.k6)((()=>[(0,i.bF)(D,{ref_key:"uploadRef",ref:m,"file-list":k.fileList,"onUpdate:fileList":d[3]||(d[3]=e=>k.fileList=e),action:"#",limit:1,"auto-upload":!1,"on-exceed":z,"on-change":x},{trigger:(0,i.k6)((()=>[(0,i.bF)(c,{type:"primary"},{default:(0,i.k6)((()=>d[13]||(d[13]=[(0,i.eW)("选择文件")]))),_:1})])),tip:(0,i.k6)((()=>d[14]||(d[14]=[(0,i.Lk)("div",{class:"el-upload__tip text-red"}," 仅限上传 1 个文件 (如 .docx, .pdf) ",-1)]))),_:1},8,["file-list"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue"]),(0,i.bF)(q,{modelValue:h.value,"onUpdate:modelValue":d[7]||(d[7]=e=>h.value=e),title:"历史版本",width:"60%"},{footer:(0,i.k6)((()=>[(0,i.bF)(c,{onClick:d[6]||(d[6]=e=>h.value=!1)},{default:(0,i.k6)((()=>d[18]||(d[18]=[(0,i.eW)("关闭")]))),_:1})])),default:(0,i.k6)((()=>[(0,i.Lk)("p",null,"模板名称: "+(0,o.v_)(g.value?.name),1),(0,i.bF)(R,{data:g.value?.versions||[],border:"",size:"small",style:{"margin-top":"10px"}},{default:(0,i.k6)((()=>[(0,i.bF)(_,{prop:"version",label:"版本号",width:"100"}),(0,i.bF)(_,{prop:"uploader",label:"上传人",width:"120"}),(0,i.bF)(_,{prop:"uploadTime",label:"上传时间",width:"160"}),(0,i.bF)(_,{prop:"fileSize",label:"文件大小",width:"120"},{default:(0,i.k6)((e=>[(0,i.eW)((0,o.v_)((e.row.fileSize/1024).toFixed(1))+" KB",1)])),_:1}),(0,i.bF)(_,{label:"操作",width:"100"},{default:(0,i.k6)((e=>[(0,i.bF)(c,{text:"",type:"primary",size:"small",icon:(0,t.R1)(n.f5X),onClick:l=>T(e.row,!0)},{default:(0,i.k6)((()=>d[17]||(d[17]=[(0,i.eW)("下载")]))),_:2},1032,["icon","onClick"])])),_:1})])),_:1},8,["data"])])),_:1},8,["modelValue"])])),_:1})])}}};var v=a(6262);const f=(0,v.A)(c,[["__scopeId","data-v-69b7607c"]]),m=f}}]);
//# sourceMappingURL=647.4d1d439b.js.map