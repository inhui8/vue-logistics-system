"use strict";(self["webpackChunkvue_logistics_system"]=self["webpackChunkvue_logistics_system"]||[]).push([[6734],{6734:(e,l,t)=>{t.r(l),t.d(l,{default:()=>c});var a=t(641),i=t(33),n=t(953),o=t(163);const p={class:"deduction-details-container"},r={style:{color:"red","font-weight":"bold"}},u={class:"rule-context"},d={key:1},s={__name:"SupplierDeductionDetails",setup(e){const l=(0,n.KR)(!1),t=(0,n.KR)(0),s=(0,n.KR)([]),m=(0,n.Kh)({supplierName:"",deductionType:"",status:null,dateRange:[]}),g=(0,n.Kh)({pageNum:1,pageSize:10,supplierName:"",deductionType:"",isExempt:null,beginTime:"",endTime:""}),c={pickup:"提框",delivery:"派送",both:"综合"};(0,a.sV)((()=>{b()}));const b=async()=>{l.value=!0,g.supplierName=m.supplierName,g.deductionType=m.deductionType,g.isExempt=m.status,g.beginTime=m.dateRange?m.dateRange[0]:"",g.endTime=m.dateRange?m.dateRange[1]:"",console.log("查询参数:",g),await new Promise((e=>setTimeout(e,500)));const e=F(g);s.value=e.list.map((e=>({...e,exemptLoading:!1}))),t.value=e.total,l.value=!1},f=()=>{g.pageNum=1,b()},v=()=>{m.supplierName="",m.deductionType="",m.status=null,m.dateRange=[],g.pageNum=1},y=e=>{g.pageSize=e,b()},k=e=>{g.pageNum=e,b()},_=async e=>{const l=s.value.find((l=>l.id===e));if(l){l.exemptLoading=!0,console.log("豁免扣分 ID:",e,"操作员: [当前登录用户]");try{await new Promise((e=>setTimeout(e,500))),l.isExempt=!0,l.statusLabel="已豁免",l.exemptionOperator="当前用户",o.nk.success("扣分豁免成功")}catch(t){console.error("豁免操作失败:",t),o.nk.error("豁免操作失败")}finally{l.exemptLoading=!1}}},h=[{id:"supplier_1",name:"测试供应商A - 专做提框服务",type:"pickup"},{id:"supplier_2",name:"测试供应商B - FBA派送专家",type:"delivery"},{id:"supplier_3",name:"测试供应商C - 全能型选手",type:"both"}],w=[{value:"late_pickup",label:"迟到提货",points:5,context:{ruleName:"准时提货率 - 扣分档位 1",triggeringData:{计划提货时间:"2024-04-10 10:00",实际提货时间:"2024-04-10 11:30"}}},{value:"late_delivery",label:"迟到派送",points:8,context:{ruleName:"准时送达率 - 扣分档位 2",triggeringData:{计划送达时间:"2024-04-11 15:00",实际送达时间:"2024-04-12 09:00"}}},{value:"damage",label:"货损",points:15,context:{ruleName:"货损率 - 扣分档位 1",triggeringData:{货损金额:"850元",货损类型:"包装破损"}}},{value:"complaint",label:"客户投诉",points:10,context:{ruleName:"客户投诉次数 - 扣分档位 1",triggeringData:{投诉级别:"严重",投诉内容:"司机态度恶劣"}}},{value:"cert_expired",label:"证照过期",points:20,context:{ruleName:"证照过期次数 - 扣分",triggeringData:{证照类型:"驾驶证",过期日期:"2024-03-15"}}}];let x=1;const F=e=>{const l=[],t=new Date;for(let p=0;p<50;p++){const e=h[p%h.length],a=w[p%w.length],i=new Date(t.getTime()-24*p*60*60*1e3*Math.random()),n=Math.random()<.2;l.push({id:"deduct_"+x++,supplierId:e.id,supplierName:e.name,supplierType:e.type,supplierTypeLabel:c[e.type]||"未知",deductionType:a.label,pointsDeducted:a.points,deductionRecordNo:`DED-${i.toISOString().slice(0,10).replace(/-/g,"")}-${String(x).padStart(3,"0")}`,ruleContext:a.context,timestamp:i.toISOString().slice(0,19).replace("T"," "),operator:["系统自动","张三","李四"][p%3],isExempt:n,exemptionOperator:n?["王五","赵六"][p%2]:null,exemptionTimestamp:n?new Date(i.getTime()+864e5*Math.random()).toISOString().slice(0,19).replace("T"," "):null,statusLabel:n?"已豁免":"已扣分"})}const a=l.filter((l=>!(e.supplierName&&!l.supplierName.includes(e.supplierName))&&((null===e.isExempt||l.isExempt===e.isExempt)&&(!(e.beginTime&&l.timestamp<e.beginTime)&&!(e.endTime&&l.timestamp>e.endTime+" 23:59:59"))))),i=(e.pageNum-1)*e.pageSize,n=i+e.pageSize,o=a.slice(i,n);return{list:o,total:a.length}};return(e,n)=>{const o=(0,a.g2)("el-input"),c=(0,a.g2)("el-form-item"),b=(0,a.g2)("el-option"),h=(0,a.g2)("el-select"),w=(0,a.g2)("el-date-picker"),x=(0,a.g2)("el-button"),F=(0,a.g2)("el-form"),N=(0,a.g2)("el-table-column"),T=(0,a.g2)("el-tag"),D=(0,a.g2)("el-popconfirm"),C=(0,a.g2)("el-table"),E=(0,a.g2)("el-pagination"),S=(0,a.g2)("el-card"),L=(0,a.gN)("loading");return(0,a.uX)(),(0,a.CE)("div",p,[(0,a.bF)(S,null,{header:(0,a.k6)((()=>n[4]||(n[4]=[(0,a.Lk)("div",{class:"card-header"},[(0,a.Lk)("span",null,"供应商扣分详情记录")],-1)]))),default:(0,a.k6)((()=>[(0,a.bF)(F,{inline:!0,model:m,size:"small",class:"filter-form"},{default:(0,a.k6)((()=>[(0,a.bF)(c,{label:"供应商名称"},{default:(0,a.k6)((()=>[(0,a.bF)(o,{modelValue:m.supplierName,"onUpdate:modelValue":n[0]||(n[0]=e=>m.supplierName=e),placeholder:"输入供应商名称",clearable:""},null,8,["modelValue"])])),_:1}),(0,a.bF)(c,{label:"扣分类型"},{default:(0,a.k6)((()=>[(0,a.bF)(h,{modelValue:m.deductionType,"onUpdate:modelValue":n[1]||(n[1]=e=>m.deductionType=e),placeholder:"选择类型",clearable:""},{default:(0,a.k6)((()=>[(0,a.bF)(b,{label:"迟到提货",value:"late_pickup"}),(0,a.bF)(b,{label:"迟到派送",value:"late_delivery"}),(0,a.bF)(b,{label:"货损",value:"damage"}),(0,a.bF)(b,{label:"投诉",value:"complaint"}),(0,a.bF)(b,{label:"证照过期",value:"cert_expired"})])),_:1},8,["modelValue"])])),_:1}),(0,a.bF)(c,{label:"状态"},{default:(0,a.k6)((()=>[(0,a.bF)(h,{modelValue:m.status,"onUpdate:modelValue":n[2]||(n[2]=e=>m.status=e),placeholder:"选择状态",clearable:"",style:{width:"100px"}},{default:(0,a.k6)((()=>[(0,a.bF)(b,{label:"已扣分",value:!1}),(0,a.bF)(b,{label:"已豁免",value:!0})])),_:1},8,["modelValue"])])),_:1}),(0,a.bF)(c,{label:"日期范围"},{default:(0,a.k6)((()=>[(0,a.bF)(w,{modelValue:m.dateRange,"onUpdate:modelValue":n[3]||(n[3]=e=>m.dateRange=e),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD"},null,8,["modelValue"])])),_:1}),(0,a.bF)(c,null,{default:(0,a.k6)((()=>[(0,a.bF)(x,{type:"primary",onClick:f,loading:l.value},{default:(0,a.k6)((()=>n[5]||(n[5]=[(0,a.eW)("查询")]))),_:1},8,["loading"]),(0,a.bF)(x,{onClick:v},{default:(0,a.k6)((()=>n[6]||(n[6]=[(0,a.eW)("重置")]))),_:1})])),_:1})])),_:1},8,["model"]),(0,a.bo)(((0,a.uX)(),(0,a.Wv)(C,{data:s.value,style:{width:"100%"},border:""},{default:(0,a.k6)((()=>[(0,a.bF)(N,{type:"index",label:"序号",width:"60",align:"center"}),(0,a.bF)(N,{prop:"supplierName",label:"供应商名称",width:"200","show-overflow-tooltip":""}),(0,a.bF)(N,{prop:"supplierTypeLabel",label:"供应商类型",width:"100",align:"center"}),(0,a.bF)(N,{prop:"deductionType",label:"扣分类型/规则",width:"180","show-overflow-tooltip":""}),(0,a.bF)(N,{prop:"pointsDeducted",label:"扣分分值",width:"90",align:"center"},{default:(0,a.k6)((e=>[(0,a.Lk)("span",r,"-"+(0,i.v_)(e.row.pointsDeducted),1)])),_:1}),(0,a.bF)(N,{prop:"deductionRecordNo",label:"扣分单号",width:"180","show-overflow-tooltip":""}),(0,a.bF)(N,{label:"关联规则详情","min-width":"300"},{default:(0,a.k6)((e=>[(0,a.Lk)("div",u,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.row.ruleContext.triggeringData,((e,l)=>((0,a.uX)(),(0,a.CE)("p",{key:l},[(0,a.Lk)("strong",null,(0,i.v_)(l)+":",1),(0,a.eW)(" "+(0,i.v_)(e),1)])))),128))])])),_:1}),(0,a.bF)(N,{prop:"timestamp",label:"记录时间",width:"160",align:"center"}),(0,a.bF)(N,{prop:"statusLabel",label:"状态",width:"80",align:"center"},{default:(0,a.k6)((e=>[(0,a.bF)(T,{type:e.row.isExempt?"info":"danger",size:"small"},{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.row.isExempt?"已豁免":"已扣分"),1)])),_:2},1032,["type"])])),_:1}),(0,a.bF)(N,{label:"操作",width:"150",align:"center",fixed:"right"},{default:(0,a.k6)((e=>[e.row.isExempt?((0,a.uX)(),(0,a.CE)("span",d,"豁免人: "+(0,i.v_)(e.row.exemptionOperator||"N/A"),1)):((0,a.uX)(),(0,a.Wv)(D,{key:0,title:"确定要豁免这条扣分记录吗？","confirm-button-text":"确定","cancel-button-text":"取消",onConfirm:l=>_(e.row.id)},{reference:(0,a.k6)((()=>[(0,a.bF)(x,{type:"warning",size:"small",loading:e.row.exemptLoading},{default:(0,a.k6)((()=>n[7]||(n[7]=[(0,a.eW)(" 豁免扣分 ")]))),_:2},1032,["loading"])])),_:2},1032,["onConfirm"]))])),_:1})])),_:1},8,["data"])),[[L,l.value]]),(0,a.bF)(E,{small:"",background:"",layout:"total, sizes, prev, pager, next, jumper",total:t.value,"page-sizes":[10,20,50,100],"page-size":g.pageSize,"current-page":g.pageNum,onSizeChange:y,onCurrentChange:k,style:{"margin-top":"20px","justify-content":"flex-end"}},null,8,["total","page-size","current-page"])])),_:1})])}}};var m=t(6262);const g=(0,m.A)(s,[["__scopeId","data-v-ad01a1f4"]]),c=g}}]);
//# sourceMappingURL=6734.d87d34bf.js.map