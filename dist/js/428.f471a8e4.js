"use strict";(self["webpackChunkvue_logistics_system"]=self["webpackChunkvue_logistics_system"]||[]).push([[428],{7428:(e,l,a)=>{a.r(l),a.d(l,{default:()=>v});var s=a(641),i=a(953),r=a(33),d=a(7918),t=a(163),n=a(8548);const o={class:"role-list-container"},u={class:"card-header"},p={class:"dialog-footer"},c={__name:"RoleList",setup(e){const l=[{id:"user1",username:"pickup_op1",realName:"提货员A",supplierId:1,supplierName:"测试供应商A",enabled:!0},{id:"user2",username:"pickup_admin",realName:"提货主管",supplierId:1,supplierName:"测试供应商A",enabled:!0},{id:"user3",username:"delivery_driver1",realName:"派送司机B1",supplierId:2,supplierName:"测试供应商B",enabled:!0},{id:"user4",username:"delivery_dispatch",realName:"派送调度B",supplierId:2,supplierName:"测试供应商B",enabled:!1},{id:"user5",username:"universal_op",realName:"全能操作C",supplierId:3,supplierName:"测试供应商C",enabled:!0},{id:"user6",username:"backend_admin1",realName:"后台管理员1",supplierId:null,supplierName:"内部",enabled:!0},{id:"user7",username:"backend_admin2",realName:"后台管理员2",supplierId:null,supplierName:"内部",enabled:!0}],a=(0,i.KR)([{id:"role_pickup_standard",name:"标准提框商",description:"负责码头提柜到仓库的基础操作权限",users:[l[0],l[1]],permissions:["order:seas:portal:list","order:seas:portal:assign_vehicle","order:seas:portal:update_status","vehicle:portal:list","account:view"]},{id:"role_delivery_standard",name:"标准派送商",description:"负责仓库到 FBA 或其他地址的派送操作权限",users:[l[2],l[3]],permissions:["order:delivery:portal:list","order:delivery:portal:assign_vehicle","order:delivery:portal:update_status","vehicle:portal:list","account:view"]},{id:"role_supplier_admin",name:"供应商管理员",description:"管理供应商内部的用户账号、车辆信息等",users:[l[4]],permissions:["order:seas:portal:list","order:delivery:portal:list","vehicle:portal:list","vehicle:portal:add","vehicle:portal:edit","vehicle:portal:delete","account:view","account:edit","account:upload_docs","quote:portal:submit_fixed","quote:portal:respond_inquiry","quote:portal:participate_bid","rating:portal:view","appointment:portal:request"]},{id:"role_admin",name:"后台管理员",description:"拥有所有后台管理权限",users:[l[5],l[6]],permissions:["*"]}]),c=(0,i.KR)([{id:"*",label:"所有权限"},{id:"supplier",label:"供应商管理 (后台)",children:[{id:"supplier:list",label:"查看列表"},{id:"supplier:create",label:"新增供应商"},{id:"supplier:edit",label:"编辑供应商"},{id:"supplier:delete",label:"删除供应商"},{id:"supplier:audit",label:"审核资质"},{id:"supplier:approve_qualification",label:"批准合作 (审批)"}]},{id:"account",label:"账户管理 (门户)",children:[{id:"account:view",label:"查看账户信息"},{id:"account:edit",label:"编辑基本信息"},{id:"account:upload_docs",label:"上传资质文件"}]}]),m=(0,i.KR)(!1),b=(0,i.KR)(""),v=(0,i.KR)(!1),k=(0,i.KR)(null),h=(0,i.KR)(!1),f=(0,i.KR)(null),_=(0,i.KR)(null),g={id:null,name:"",description:"",permissions:[],users:[]},y=(0,i.Kh)({...g}),w=(0,i.Kh)({name:[{required:!0,message:"请输入角色名称",trigger:"blur"}],description:[{required:!0,message:"请输入角色描述",trigger:"blur"}]}),F=(e,l)=>{if(console.log("Checked keys:",l.checkedKeys),y.permissions=_.value.getCheckedKeys(!1),y.permissions.includes("*")){const e=C(c.value);y.permissions=e,(0,s.dY)((()=>{_.value.setCheckedKeys(e,!0)}))}else y.permissions=y.permissions.filter((e=>"*"!==e));console.log("Final permissions:",y.permissions)},C=e=>{let l=[];return e.forEach((e=>{"*"!==e.id&&(e.children&&0!==e.children.length?l=l.concat(C(e.children)):l.push(e.id))})),l},N=()=>{Object.assign(y,g),y.permissions=[],h.value=!1,b.value="新增角色",m.value=!0,(0,s.dY)((()=>{_.value?.setCheckedKeys([]),f.value?.clearValidate()}))},x=e=>{h.value=!0,b.value="编辑角色权限",Object.assign(y,JSON.parse(JSON.stringify(e))),m.value=!0,(0,s.dY)((()=>{f.value?.clearValidate(),y.permissions.includes("*")?_.value?.setCheckedKeys(["*"],!0):_.value?.setCheckedKeys(y.permissions||[],!0)}))},K=e=>{e.users&&e.users.length>0?d.s.alert(`角色 "${e.name}" 下关联了 ${e.users.length} 个用户，请先将用户移除或分配到其他角色后再删除。`,"无法删除",{type:"error"}):d.s.confirm(`确定要删除角色 "${e.name}" 吗?`,"确认删除",{type:"warning"}).then((()=>{console.log("删除角色:",e.id);const l=a.value.findIndex((l=>l.id===e.id));-1!==l?(a.value.splice(l,1),t.nk.success("角色删除成功")):t.nk.error("删除失败")})).catch((()=>{}))},V=e=>{k.value=JSON.parse(JSON.stringify(e)),v.value=!0},I=e=>{console.log(`更改用户 ${e.username} 状态为: ${e.enabled}`);const a=l.findIndex((l=>l.id===e.id));-1!==a&&(l[a].enabled=e.enabled);const s=k.value.users.findIndex((l=>l.id===e.id));-1!==s&&(k.value.users[s].enabled=e.enabled),t.nk.success(`用户 ${e.username} 状态已${e.enabled?"启用":"禁用"}`)},O=e=>{k.value&&d.s.confirm(`确定要将用户 "${e.username}" 从角色 "${k.value.name}" 中移除吗?`,"确认移除",{type:"warning"}).then((()=>{console.log(`移除用户 ${e.username} 从角色 ${k.value.id}`);const l=k.value.users.findIndex((l=>l.id===e.id));-1!==l&&k.value.users.splice(l,1);const s=a.value.findIndex((e=>e.id===k.value.id));if(-1!==s){const l=a.value[s].users.findIndex((l=>l.id===e.id));-1!==l&&a.value[s].users.splice(l,1)}t.nk.success("用户已移除")})).catch((()=>{}))},R=()=>{(0,s.dY)((()=>{f.value?.clearValidate(),_.value?.setCheckedKeys([])})),Object.assign(y,g)},$=async()=>{if(f.value)try{if(await f.value.validate(),y.permissions=_.value.getCheckedKeys(!1),y.permissions.includes("*")?console.warn("选择了 '所有权限', 实际保存的权限列表将根据后端逻辑处理。"):y.permissions=y.permissions.filter((e=>"*"!==e)),console.log("提交的角色数据:",JSON.parse(JSON.stringify(y))),h.value){const e=a.value.findIndex((e=>e.id===y.id));-1!==e?(a.value[e]={...a.value[e],...JSON.parse(JSON.stringify(y))},t.nk.success("角色权限更新成功")):t.nk.error("更新失败")}else{const e={...JSON.parse(JSON.stringify(y)),id:`role_${Date.now()}`,users:[]};a.value.push(e),t.nk.success("角色新增成功")}m.value=!1}catch(e){console.log("表单验证失败:",e),t.nk.error("请检查表单信息")}};return(e,l)=>{const d=(0,s.g2)("el-icon"),t=(0,s.g2)("el-button"),h=(0,s.g2)("el-table-column"),g=(0,s.g2)("el-table"),C=(0,s.g2)("el-input"),J=(0,s.g2)("el-form-item"),S=(0,s.g2)("el-tree"),W=(0,s.g2)("el-form"),q=(0,s.g2)("el-dialog"),U=(0,s.g2)("el-switch"),A=(0,s.g2)("el-card");return(0,s.uX)(),(0,s.CE)("div",o,[(0,s.bF)(A,null,{header:(0,s.k6)((()=>[(0,s.Lk)("div",u,[l[7]||(l[7]=(0,s.Lk)("span",null,"角色列表",-1)),(0,s.bF)(t,{type:"primary",onClick:N},{default:(0,s.k6)((()=>[(0,s.bF)(d,null,{default:(0,s.k6)((()=>[(0,s.bF)((0,i.R1)(n.FWt))])),_:1}),l[6]||(l[6]=(0,s.eW)(" 新增角色 "))])),_:1})])])),default:(0,s.k6)((()=>[(0,s.bF)(g,{data:a.value,style:{width:"100%"},border:""},{default:(0,s.k6)((()=>[(0,s.bF)(h,{prop:"name",label:"角色名称",width:"200"}),(0,s.bF)(h,{prop:"description",label:"描述","show-overflow-tooltip":""}),(0,s.bF)(h,{label:"关联用户数",width:"150",align:"center"},{default:(0,s.k6)((e=>[(0,s.bF)(t,{type:"primary",link:"",onClick:l=>V(e.row)},{default:(0,s.k6)((()=>[(0,s.eW)((0,r.v_)(e.row.users?.length||0)+" 人 ",1)])),_:2},1032,["onClick"])])),_:1}),(0,s.bF)(h,{label:"操作",fixed:"right",width:"180"},{default:(0,s.k6)((e=>[(0,s.bF)(t,{text:"",type:"primary",size:"small",onClick:l=>x(e.row)},{default:(0,s.k6)((()=>l[8]||(l[8]=[(0,s.eW)("编辑权限")]))),_:2},1032,["onClick"]),(0,s.bF)(t,{text:"",type:"danger",size:"small",onClick:l=>K(e.row)},{default:(0,s.k6)((()=>l[9]||(l[9]=[(0,s.eW)("删除")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),(0,s.bF)(q,{modelValue:m.value,"onUpdate:modelValue":l[3]||(l[3]=e=>m.value=e),title:b.value,width:"50%",onClose:R,"close-on-click-modal":!1},{footer:(0,s.k6)((()=>[(0,s.Lk)("span",p,[(0,s.bF)(t,{onClick:l[2]||(l[2]=e=>m.value=!1)},{default:(0,s.k6)((()=>l[10]||(l[10]=[(0,s.eW)("取消")]))),_:1}),(0,s.bF)(t,{type:"primary",onClick:$},{default:(0,s.k6)((()=>l[11]||(l[11]=[(0,s.eW)("确认")]))),_:1})])])),default:(0,s.k6)((()=>[(0,s.bF)(W,{ref_key:"roleFormRef",ref:f,model:y,rules:w,"label-width":"80px"},{default:(0,s.k6)((()=>[(0,s.bF)(J,{label:"角色名称",prop:"name"},{default:(0,s.k6)((()=>[(0,s.bF)(C,{modelValue:y.name,"onUpdate:modelValue":l[0]||(l[0]=e=>y.name=e),placeholder:"请输入角色名称"},null,8,["modelValue"])])),_:1}),(0,s.bF)(J,{label:"描述",prop:"description"},{default:(0,s.k6)((()=>[(0,s.bF)(C,{modelValue:y.description,"onUpdate:modelValue":l[1]||(l[1]=e=>y.description=e),type:"textarea",rows:2,placeholder:"请输入角色描述"},null,8,["modelValue"])])),_:1}),(0,s.bF)(J,{label:"权限配置"},{default:(0,s.k6)((()=>[(0,s.bF)(S,{ref_key:"permissionTreeRef",ref:_,data:c.value,"show-checkbox":"","node-key":"id","default-expand-all":"","default-checked-keys":y.permissions,props:{children:"children",label:"label"},style:{width:"100%",border:"1px solid #dcdfe6","border-radius":"4px",padding:"10px","max-height":"300px","overflow-y":"auto"},onCheck:F},null,8,["data","default-checked-keys"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),(0,s.bF)(q,{modelValue:v.value,"onUpdate:modelValue":l[5]||(l[5]=e=>v.value=e),title:`角色用户管理 - ${k.value?.name}`,width:"60%","close-on-click-modal":!1},{footer:(0,s.k6)((()=>[(0,s.bF)(t,{onClick:l[4]||(l[4]=e=>v.value=!1)},{default:(0,s.k6)((()=>l[13]||(l[13]=[(0,s.eW)("关闭")]))),_:1})])),default:(0,s.k6)((()=>[(0,s.bF)(g,{data:k.value?.users,style:{width:"100%"},border:"",size:"small"},{default:(0,s.k6)((()=>[(0,s.bF)(h,{prop:"username",label:"用户名"}),(0,s.bF)(h,{prop:"realName",label:"姓名"}),(0,s.bF)(h,{prop:"supplierName",label:"所属供应商 (若有)","show-overflow-tooltip":""}),(0,s.bF)(h,{label:"账号状态",width:"120",align:"center"},{default:(0,s.k6)((e=>[(0,s.bF)(U,{modelValue:e.row.enabled,"onUpdate:modelValue":l=>e.row.enabled=l,"active-text":"启用","inactive-text":"禁用","inline-prompt":"",onChange:l=>I(e.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),(0,s.bF)(h,{label:"操作",width:"100",align:"center"},{default:(0,s.k6)((e=>[(0,s.bF)(t,{text:"",type:"danger",size:"small",onClick:l=>O(e.row)},{default:(0,s.k6)((()=>l[12]||(l[12]=[(0,s.eW)("移除")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])])),_:1},8,["modelValue","title"])])),_:1})])}}};var m=a(6262);const b=(0,m.A)(c,[["__scopeId","data-v-aca8de5e"]]),v=b}}]);
//# sourceMappingURL=428.f471a8e4.js.map