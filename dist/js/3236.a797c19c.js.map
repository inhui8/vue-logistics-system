{"version":3,"file":"js/3236.a797c19c.js","mappings":"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","sources":["webpack://vue-logistics-system/./src/views/Admin/RatingManagement/RatingRulesConfig.vue","webpack://vue-logistics-system/./src/views/Admin/RatingManagement/RatingRulesConfig.vue?40aa"],"sourcesContent":["<template>\n  <div class=\"rating-rules-container\">\n    <el-card>\n      <template #header>\n        <div class=\"card-header\">\n          <span>评分规则配置 (基于指标)</span>\n           <el-button type=\"primary\" @click=\"saveRules\" :loading=\"saving\">保存规则</el-button>\n        </div>\n      </template>\n\n       <el-alert title=\"配置说明\" type=\"info\" show-icon :closable=\"false\" style=\"margin-bottom: 20px;\">\n        在此为评分指标设定具体的得分标准、奖励和惩罚规则。这些规则将用于计算每个供应商在每个评分周期的实际得分。\n      </el-alert>\n\n      <el-tabs v-model=\"activeDimensionId\" class=\"dimension-tabs\">\n        <el-tab-pane \n          v-for=\"dimension in config.dimensions\" \n          :key=\"dimension.id\" \n          :label=\"dimension.name || '未命名维度'\" \n          :name=\"dimension.id\"\n         >\n          <div v-if=\"dimension.indicators && dimension.indicators.length > 0\">\n              <h4>指标 \"{{ dimension.name }}\" 的评分规则</h4>\n             <div v-for=\"indicator in dimension.indicators\" :key=\"indicator.id\" class=\"indicator-rules-block\">\n                <h5>{{ indicator.name }} ({{ indicator.weight }}%)</h5>\n                 <p class=\"indicator-desc\">{{ indicator.description }}</p>\n\n                 <!-- 规则配置区域 (根据指标类型不同，可能需要不同配置方式) -->\n                <div v-if=\"isPercentageBased(indicator)\" class=\"rule-section\">\n                    <h6>评分标准 (百分比型)</h6>\n                     <div v-for=\"(level, levelIndex) in getRuleLevels(indicator.id)\" :key=\"levelIndex\" class=\"rule-level\">\n                        当指标值 <span v-if=\"isPositivePercentage(indicator)\">&gt;=</span><span v-else>&lt;=</span> <el-input-number v-model=\"level.threshold\" size=\"small\" :min=\"0\" :max=\"100\" :step=\"1\" controls-position=\"right\" style=\"width: 100px; margin: 0 5px;\"/> % 时，得 <el-input-number v-model=\"level.score\" size=\"small\" :min=\"0\" :max=\"100\" :step=\"5\" controls-position=\"right\" style=\"width: 100px; margin: 0 5px;\"/> 分\n                        <el-button type=\"danger\" :icon=\"Delete\" plain circle size=\"small\" @click=\"removeRuleLevel(indicator.id, levelIndex)\" style=\"margin-left: 10px;\"/>\n                     </div>\n                      <el-button type=\"primary\" link :icon=\"Plus\" @click=\"addRuleLevel(indicator.id)\">添加评分档位</el-button>\n                </div>\n                 <div v-else-if=\"isCountBased(indicator)\" class=\"rule-section\">\n                     <h6>评分标准 (计数型/频率型)</h6>\n                      <div v-for=\"(level, levelIndex) in getRuleLevels(indicator.id)\" :key=\"levelIndex\" class=\"rule-level\">\n                        当指标值 &lt;= <el-input-number v-model=\"level.threshold\" size=\"small\" :min=\"0\" :step=\"1\" controls-position=\"right\" style=\"width: 100px; margin: 0 5px;\"/> 次/个 时，得 <el-input-number v-model=\"level.score\" size=\"small\" :min=\"0\" :max=\"100\" :step=\"5\" controls-position=\"right\" style=\"width: 100px; margin: 0 5px;\"/> 分\n                        <el-button type=\"danger\" :icon=\"Delete\" plain circle size=\"small\" @click=\"removeRuleLevel(indicator.id, levelIndex)\" style=\"margin-left: 10px;\"/>\n                     </div>\n                      <el-button type=\"primary\" link :icon=\"Plus\" @click=\"addRuleLevel(indicator.id)\">添加评分档位</el-button>\n                 </div>\n                  <div v-else class=\"rule-section\">\n                     <h6>评分标准 (其他类型 - 待实现具体配置方式)</h6>\n                     <p style=\"color: #909399;\">例如：布尔型 (是/否)，或需要更复杂逻辑的指标。</p>\n                 </div>\n\n                 <!-- 奖惩规则 -->\n                  <div class=\"rule-section bonus-penalty\">\n                     <h6>附加奖惩规则 (可选)</h6>\n                      <div v-for=\"(rule, ruleIndex) in getBonusPenaltyRules(indicator.id)\" :key=\"ruleIndex\" class=\"bonus-penalty-rule\">\n                          当 <el-input v-model=\"rule.condition\" placeholder=\"触发条件描述\" size=\"small\" style=\"width: 250px; margin-right: 10px;\"/> 时，\n                          <el-select v-model=\"rule.type\" placeholder=\"类型\" size=\"small\" style=\"width: 100px; margin: 0 5px;\">\n                             <el-option label=\"加分\" value=\"bonus\" />\n                             <el-option label=\"扣分\" value=\"penalty\" />\n                           </el-select>\n                           <el-input-number v-model=\"rule.value\" size=\"small\" :min=\"0\" :step=\"1\" controls-position=\"right\" style=\"width: 100px; margin: 0 5px;\"/> 分\n                          <el-button type=\"danger\" :icon=\"Delete\" plain circle size=\"small\" @click=\"removeBonusPenaltyRule(indicator.id, ruleIndex)\" style=\"margin-left: 10px;\"/>\n                     </div>\n                      <el-button type=\"primary\" link :icon=\"Plus\" @click=\"addBonusPenaltyRule(indicator.id)\">添加奖惩规则</el-button>\n                  </div>\n                 <el-divider v-if=\"indicator !== dimension.indicators[dimension.indicators.length - 1]\" />\n             </div>\n          </div>\n           <div v-else style=\"text-align: center; color: #909399; padding: 20px;\">\n              请先在\"指标配置\"页面为该维度添加指标。\n           </div>\n        </el-tab-pane>\n      </el-tabs>\n\n    </el-card>\n  </div>\n</template>\n\n<script setup>\nimport { ref, reactive, onMounted } from 'vue';\nimport { ElMessage } from 'element-plus';\nimport { Plus, Delete } from '@element-plus/icons-vue';\n\n// --- 模拟配置数据 ---\n// 沿用指标配置的数据结构 (实际应从 API 获取)\nconst config = reactive({\n  dimensions: []\n});\n\n// 存储规则的数据结构，以 indicatorId 为 key\nconst rules = reactive({});\n\nconst saving = ref(false);\nconst activeDimensionId = ref(null);\n\n// 加载模拟的指标配置和规则\nconst loadMockData = () => {\n  // 加载指标配置 (与 RatingIndicatorConfig.vue 相同，实际应共享或 API 获取)\n   config.dimensions = [\n        {\n            id: `dim_mock_1`, name: '时效性', weight: 40,\n            indicators: [\n                { id: `ind_mock_1_1`, name: '准时提货率', description: '按约定时间完成提货的比例', weight: 50, type: 'percentage' },\n                { id: `ind_mock_1_2`, name: '准时送达率', description: '按约定时间完成送达的比例', weight: 50, type: 'percentage' },\n            ]\n        },\n        {\n            id: `dim_mock_2`, name: '服务质量', weight: 30,\n            indicators: [\n                { id: `ind_mock_2_1`, name: '货损率', description: '运输过程中货物损坏的比例', weight: 40, type: 'percentage' },\n                { id: `ind_mock_2_2`, name: '客户投诉次数', description: '因服务问题导致客户投诉的次数', weight: 30, type: 'count' },\n                { id: `ind_mock_2_3`, name: 'POD返回及时率', description: '签收单按时返回的比例', weight: 30, type: 'percentage' },\n            ]\n        },\n         {\n            id: `dim_mock_4`, name: '合规与配合度', weight: 10,\n            indicators: [\n                { id: `ind_mock_4_1`, name: '证照过期次数', description: '车辆、司机证照过期的次数', weight: 50, type: 'count' },\n                { id: `ind_mock_4_2`, name: '系统操作出错次数', description: '供应商门户系统操作错误的次数', weight: 50, type: 'count' },\n            ]\n        }\n    ];\n    // 设置默认激活第一个维度\n    if (config.dimensions.length > 0) {\n        activeDimensionId.value = config.dimensions[0].id;\n    }\n\n    // 加载模拟规则 (为每个指标生成一些默认规则)\n    config.dimensions.forEach(dim => {\n        dim.indicators.forEach(ind => {\n            if (!rules[ind.id]) {\n                rules[ind.id] = { levels: [], bonusPenalties: [] };\n            }\n            // 添加默认评分档位规则\n             if (ind.type === 'percentage') {\n                if (ind.name.includes('率') && !ind.name.includes('货损')) { // 正向指标\n                     rules[ind.id].levels = [\n                         { threshold: 98, score: 100 },\n                         { threshold: 95, score: 90 },\n                         { threshold: 90, score: 80 },\n                         { threshold: 80, score: 60 },\n                     ];\n                } else { // 反向指标 (如货损率)\n                     rules[ind.id].levels = [\n                         { threshold: 1, score: 80 },\n                         { threshold: 3, score: 60 },\n                         { threshold: 5, score: 40 },\n                     ];\n                }\n            } else if (ind.type === 'count') { // 计数型，通常是越少越好\n                 rules[ind.id].levels = [\n                     { threshold: 0, score: 100 },\n                     { threshold: 1, score: 80 },\n                     { threshold: 3, score: 60 },\n                 ];\n            }\n            // 确保档位按正确顺序排序以供显示和计算\n             ensureLevelSort(ind.id);\n            \n            // 添加默认奖惩规则 (示例)\n             if (ind.name.includes('送达率')) {\n                 rules[ind.id].bonusPenalties = [\n                    { condition: '连续3个周期达标', type: 'bonus', value: 5 }\n                 ];\n             }\n             if (ind.name.includes('投诉')) {\n                  rules[ind.id].bonusPenalties = [\n                    { condition: '发生重大投诉事件', type: 'penalty', value: 20 }\n                 ];\n             }\n        });\n    });\n};\n\n// --- 方法 ---\n// 判断指标类型 (简化)\nconst isPercentageBased = (indicator) => indicator.type === 'percentage' || indicator.name.includes('率');\nconst isCountBased = (indicator) => indicator.type === 'count' || indicator.name.includes('次数');\n// 判断是否是正向百分比指标 (越高越好)\nconst isPositivePercentage = (indicator) => isPercentageBased(indicator) && !indicator.name.includes('货损');\n\n// 确保评分档位按正确的顺序排序\nconst ensureLevelSort = (indicatorId) => {\n    if (!rules[indicatorId] || !rules[indicatorId].levels) return;\n    const indicator = findIndicatorById(indicatorId);\n    if (indicator && isPositivePercentage(indicator)) {\n        // 正向百分比，阈值降序\n        rules[indicatorId].levels.sort((a, b) => b.threshold - a.threshold);\n    } else {\n        // 反向百分比或计数型，阈值升序\n        rules[indicatorId].levels.sort((a, b) => a.threshold - b.threshold);\n    }\n};\n\n// 获取特定指标的规则等级 (已排序)\nconst getRuleLevels = (indicatorId) => {\n  if (!rules[indicatorId]) {\n    rules[indicatorId] = { levels: [], bonusPenalties: [] };\n  }\n  // 确保每次获取时都是排序的\n  ensureLevelSort(indicatorId);\n  return rules[indicatorId].levels;\n};\n\n// 获取特定指标的奖惩规则\nconst getBonusPenaltyRules = (indicatorId) => {\n  if (!rules[indicatorId]) {\n    rules[indicatorId] = { levels: [], bonusPenalties: [] };\n  }\n  return rules[indicatorId].bonusPenalties;\n};\n\n// 添加评分档位\nconst addRuleLevel = (indicatorId/*, type*/) => {\n   if (!rules[indicatorId]) {\n    rules[indicatorId] = { levels: [], bonusPenalties: [] };\n  }\n  // 根据类型决定初始阈值方向，避免混乱\n  const indicator = findIndicatorById(indicatorId);\n  let initialThreshold = 0;\n  if (indicator && isPositivePercentage(indicator)) initialThreshold = 70; // 正向给个低点的\n  \n  rules[indicatorId].levels.push({ threshold: initialThreshold, score: 0 });\n  // 添加后需要重新排序以正确显示\n   ensureLevelSort(indicatorId); \n};\n\n// 移除评分档位\nconst removeRuleLevel = (indicatorId, levelIndex) => {\n   // 因为 getRuleLevels 返回的是排序后的数组，index 是可靠的\n   if (rules[indicatorId] && rules[indicatorId].levels) {\n     rules[indicatorId].levels.splice(levelIndex, 1);\n   }\n};\n\n// 添加奖惩规则\nconst addBonusPenaltyRule = (indicatorId) => {\n   if (!rules[indicatorId]) {\n    rules[indicatorId] = { levels: [], bonusPenalties: [] };\n  }\n  rules[indicatorId].bonusPenalties.push({ condition: '', type: 'bonus', value: 0 });\n};\n\n// 移除奖惩规则\nconst removeBonusPenaltyRule = (indicatorId, ruleIndex) => {\n   if (rules[indicatorId] && rules[indicatorId].bonusPenalties) {\n     rules[indicatorId].bonusPenalties.splice(ruleIndex, 1);\n   }\n};\n\n// 根据 ID 查找指标 (辅助函数)\nconst findIndicatorById = (indicatorId) => {\n    for (const dim of config.dimensions) {\n        const found = dim.indicators.find(ind => ind.id === indicatorId);\n        if (found) return found;\n    }\n    return null;\n};\n\n// 保存规则 (模拟)\nconst saveRules = () => {\n  // 可以添加规则校验逻辑，例如档位是否有序，分数是否合理等\n  saving.value = true;\n  console.log('保存评分规则:', JSON.parse(JSON.stringify(rules)));\n  // 模拟 API 调用\n  setTimeout(() => {\n    saving.value = false;\n    ElMessage.success('评分规则已保存');\n  }, 1000);\n};\n\n// --- 生命周期 ---\nonMounted(() => {\n  loadMockData();\n});\n\n</script>\n\n<style scoped>\n.rating-rules-container {\n  padding: 20px;\n}\n.card-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n.dimension-tabs {\n    margin-top: 10px;\n}\n.indicator-rules-block {\n    border: 1px solid #f2f6fc;\n    background-color: #fff;\n    border-radius: 4px;\n    padding: 15px;\n    margin-bottom: 15px;\n}\nh5 {\n    margin-bottom: 5px;\n    font-size: 1.1em;\n}\n.indicator-desc {\n    color: #909399;\n    font-size: 0.9em;\n    margin-bottom: 15px;\n}\n.rule-section {\n    margin-bottom: 15px;\n    padding-left: 10px;\n}\nh6 {\n    margin-bottom: 10px;\n    font-size: 1em;\n    color: #303133;\n}\n.rule-level,\n.bonus-penalty-rule {\n    margin-bottom: 8px;\n    display: flex;\n    align-items: center;\n}\n.bonus-penalty {\n    margin-top: 20px;\n    border-top: 1px dashed #e4e7ed;\n    padding-top: 15px;\n}\n\n/* Element Plus overrides (optional) */\n:deep(.el-tabs__header) {\n    margin-bottom: 20px;\n}\n:deep(.el-tabs__nav-wrap::after) {\n    height: 1px;\n}\n</style> ","import script from \"./RatingRulesConfig.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./RatingRulesConfig.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./RatingRulesConfig.vue?vue&type=style&index=0&id=6eeedf07&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-6eeedf07\"]])\n\nexport default __exports__"],"names":["config","reactive","dimensions","rules","saving","ref","activeDimensionId","loadMockData","id","name","weight","indicators","description","type","length","value","forEach","dim","ind","levels","bonusPenalties","includes","threshold","score","ensureLevelSort","condition","isPercentageBased","indicator","isCountBased","isPositivePercentage","indicatorId","findIndicatorById","sort","a","b","getRuleLevels","getBonusPenaltyRules","addRuleLevel","initialThreshold","push","removeRuleLevel","levelIndex","splice","addBonusPenaltyRule","removeBonusPenaltyRule","ruleIndex","found","find","saveRules","console","log","JSON","parse","stringify","setTimeout","ElMessage","success","onMounted","__exports__"],"sourceRoot":""}