"use strict";(self["webpackChunkvue_logistics_system"]=self["webpackChunkvue_logistics_system"]||[]).push([[9595],{1976:(e,l,a)=>{a.r(l),a.d(l,{default:()=>q});var t=a(641),o=a(953),n=a(3751),u=a(33),s=a(5220),c=a(163),i=a(562),d=a(1361),r=a(8224),k=a(1857),v=a(5703),p=a(2085),R=a(3022),b=a(8548);const m={class:"outbound-view-wrapper"},f={class:"phone-mockup"},g={class:"phone-screen"},h={key:0,class:"scan-container"},C={class:"scan-area"},L={class:"scan-icon"},y={class:"scan-input-area"},_={class:"virtual-code-btn"},F={key:1,class:"outbound-container"},S={class:"train-info"},w={class:"confirm-button-container"},W={key:2,class:"outbound-confirm-container"},K={class:"train-info"},E={class:"order-data-area"},O={key:0,class:"loading"},U={class:"order-details"},D={key:0,class:"scan-actions"},X={key:1,class:"completed-indicator"},V={key:1,class:"no-data"},j={class:"dialog-footer"},$={key:0,class:"footer-button-inside-phone"},I={class:"photo-upload-container"},T={key:0,class:"photo-placeholder"},Q={key:1,class:"photo-preview"},P=["src"],z=["onClick"],B={class:"upload-actions"},M={class:"dialog-footer"},N={key:0,class:"camera-container"},A={class:"camera-actions"},Y={key:1,class:"camera-error"},Z={__name:"OutboundConfirm",setup(e){const l=(0,s.rd)(),a=(0,o.KR)(!1),Z=(0,o.KR)(!1),x=(0,o.KR)(!1),H=(0,o.KR)(""),q=(0,o.KR)(""),G=(0,o.Kh)([]),J=(0,o.KR)(!1),ee=(0,o.KR)(""),le=(0,o.KR)(null),ae=(0,o.KR)(null),te=(0,o.KR)(""),oe=(0,o.KR)(null),ne=(0,o.KR)(!1),ue=(0,o.KR)(!1),se=(0,o.KR)([]),ce=(0,o.KR)(!0),ie=(0,o.KR)(null),de=(0,o.KR)(null);let re=null;const ke=()=>{const e=Math.floor(1e4*Math.random()).toString().padStart(4,"0"),l=new Date,a=l.getFullYear().toString().slice(2),t=(l.getMonth()+1).toString().padStart(2,"0"),o=l.getDate().toString().padStart(2,"0");H.value=`T${a}${t}${o}${e}`},ve=()=>{H.value?(c.nk.success("出库单扫描成功"),a.value=!0,q.value=H.value):c.nk.warning("请输入出库单号")},pe=()=>{console.log(`开始为车次 ${q.value} 进行出库操作`),Z.value=!0,G.length=0,Re()},Re=async()=>{x.value=!0,console.log("正在获取订单数据...");try{await new Promise((e=>setTimeout(e,500)));const e=[{palletCode:"PLT001",orderNumber:"ORD1001",originalLocation:"A1-01",status:"completed"},{palletCode:"PLT002",orderNumber:"ORD1002",originalLocation:"A1-02",status:"pending"},{palletCode:"PLT003",orderNumber:"ORD1003",originalLocation:"C3-10",status:"pending"},{palletCode:"PLT004",orderNumber:"ORD1004",originalLocation:"C3-11",status:"pending"},{palletCode:"PLT005",orderNumber:"ORD1005",originalLocation:"E5-20",status:"pending"}],l=e.map((e=>({...e,palletScanned:!1,locationScanned:!1,dockScanned:!1})));G.push(...l)}catch(e){console.error("Failed to fetch order list:",e),c.nk.error("加载订单失败")}finally{x.value=!1}},be=e=>"pending"===e?"待出库":"已出库",me=()=>{a.value=!1,Z.value=!1,H.value=""},fe=()=>{Z.value=!1},ge=()=>{l.back()},he=()=>{J.value=!0,(0,t.dY)((()=>{oe.value?.focus()}))},Ce=e=>{le.value="pallet",ae.value=e,te.value=e.palletCode,ee.value="",he()},Le=e=>{e.palletScanned?(le.value="location",ae.value=e,te.value=e.originalLocation,ee.value="",he()):c.nk.warning("请先扫描卡板")},ye=e=>{e.palletScanned?(le.value="dock",ae.value=e,te.value="DOCK",ee.value="",he()):c.nk.warning("请先扫描卡板")},_e=()=>{if(!ae.value||!le.value)return;const e=ae.value,l=ee.value.trim();if(!l)return void c.nk.warning("请输入扫描码");let a=!1;"pallet"===le.value?l===e.palletCode?(e.palletScanned=!0,c.nk.success("卡板扫描成功"),a=!0):c.nk.error("卡板码不匹配"):"location"===le.value?l===e.originalLocation?(e.locationScanned=!0,c.nk.success("库位扫描成功"),a=!0):c.nk.error("库位码不匹配"):"dock"===le.value&&(l.toUpperCase().startsWith("DOCK")?(e.dockScanned=!0,e.status="completed",c.nk.success("Dock扫描成功，出库完成"),a=!0):c.nk.error("无效的Dock码，应以DOCK开头")),a?J.value=!1:(0,t.dY)((()=>{oe.value?.select()}))},Fe=()=>{ee.value=""},Se=((0,t.EW)((()=>0!==G.length&&G.every((e=>"completed"===e.status)))),()=>{ne.value=!0}),we=e=>{if(!e)return;if(!e.raw.type.startsWith("image/"))return void c.nk.error("请上传图片文件");if(e.size/1024/1024>5)return void c.nk.error("图片大小不能超过5MB");const l=URL.createObjectURL(e.raw);se.value.push({file:e.raw,url:l})},We=e=>{URL.revokeObjectURL(se.value[e].url),se.value.splice(e,1)},Ke=async()=>{ue.value=!0,(0,t.dY)((()=>{Ee()}))},Ee=async()=>{try{re=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:!1}),ie.value&&(ie.value.srcObject=re,ce.value=!0)}catch(e){console.error("无法访问摄像头:",e),ce.value=!1,c.nk.error("无法访问摄像头，请检查浏览器权限设置")}},Oe=()=>{if(!ie.value||!re)return;const e=document.createElement("canvas"),l=e.getContext("2d"),a=ie.value;e.width=a.videoWidth,e.height=a.videoHeight,l.drawImage(a,0,0,e.width,e.height),e.toBlob((e=>{const l=URL.createObjectURL(e);se.value.push({file:new File([e],`photo_${Date.now()}.jpg`,{type:"image/jpeg"}),url:l}),Ue()}),"image/jpeg",.95)},Ue=()=>{ue.value=!1,re&&(re.getTracks().forEach((e=>e.stop())),re=null)},De=()=>{se.value.length?(c.nk.success({message:`成功上传了 ${se.value.length} 张凭证照片`,duration:2e3}),setTimeout((()=>{se.value.forEach((e=>{URL.revokeObjectURL(e.url)})),se.value=[],ne.value=!1,c.nk.success({message:`车次 ${q.value} 出库完成!`,duration:2e3})}),1e3)):c.nk.warning("请至少上传一张凭证照片")},Xe=()=>{se.value.forEach((e=>{URL.revokeObjectURL(e.url)})),se.value=[],ne.value=!1};return(0,t.hi)((()=>{re&&re.getTracks().forEach((e=>e.stop())),se.value.forEach((e=>{URL.revokeObjectURL(e.url)}))})),(e,l)=>((0,t.uX)(),(0,t.CE)("div",m,[(0,t.Lk)("div",f,[(0,t.Lk)("div",g,[a.value?(0,t.Q3)("",!0):((0,t.uX)(),(0,t.CE)("div",h,[(0,t.bF)((0,o.R1)(i.IO),{onBack:ge,content:"出库扫描"}),(0,t.Lk)("div",C,[(0,t.Lk)("div",L,[(0,t.bF)((0,o.R1)(d.tk),null,{default:(0,t.k6)((()=>[(0,t.bF)((0,o.R1)(b.mzI))])),_:1})]),l[9]||(l[9]=(0,t.Lk)("p",{class:"scan-text"},"请扫描出库单",-1)),(0,t.Lk)("div",y,[(0,t.bF)((0,o.R1)(r.WK),{modelValue:H.value,"onUpdate:modelValue":l[0]||(l[0]=e=>H.value=e),placeholder:"请输入出库单号",clearable:"",onKeyup:(0,n.jR)(ve,["enter"])},null,8,["modelValue"]),(0,t.bF)((0,o.R1)(k.S2),{type:"primary",onClick:ve},{default:(0,t.k6)((()=>l[7]||(l[7]=[(0,t.eW)("确认")]))),_:1})]),(0,t.Lk)("div",_,[(0,t.bF)((0,o.R1)(k.S2),{type:"success",onClick:ke},{default:(0,t.k6)((()=>l[8]||(l[8]=[(0,t.eW)("生成虚拟号码")]))),_:1})])])])),a.value&&!Z.value?((0,t.uX)(),(0,t.CE)("div",F,[(0,t.bF)((0,o.R1)(i.IO),{onBack:me,content:"出库任务"}),(0,t.Lk)("div",S,[(0,t.Lk)("h2",null,"车次号: "+(0,u.v_)(q.value),1)]),(0,t.Lk)("div",w,[(0,t.bF)((0,o.R1)(k.S2),{type:"primary",onClick:pe,style:{width:"100%"}},{default:(0,t.k6)((()=>l[10]||(l[10]=[(0,t.eW)("确认出库开始")]))),_:1})])])):(0,t.Q3)("",!0),Z.value?((0,t.uX)(),(0,t.CE)("div",W,[(0,t.bF)((0,o.R1)(i.IO),{onBack:fe,content:"确认出库"}),(0,t.Lk)("div",K,[(0,t.Lk)("h2",null,"车次号: "+(0,u.v_)(q.value),1)]),(0,t.Lk)("div",E,[x.value?((0,t.uX)(),(0,t.CE)("p",O,"加载订单中...")):(0,t.Q3)("",!0),((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(G,(e=>((0,t.uX)(),(0,t.Wv)((0,o.R1)(v.Ik),{shadow:"never",key:e.palletCode,class:(0,u.C4)(["order-card",{"outbound-completed":"completed"===e.status}])},{default:(0,t.k6)((()=>[(0,t.Lk)("div",U,[(0,t.Lk)("p",null,[l[11]||(l[11]=(0,t.Lk)("strong",null,"卡板号:",-1)),(0,t.eW)(" "+(0,u.v_)(e.palletCode),1)]),(0,t.Lk)("p",null,[l[12]||(l[12]=(0,t.Lk)("strong",null,"PC号:",-1)),(0,t.eW)(" "+(0,u.v_)(e.orderNumber),1)]),(0,t.Lk)("p",null,[l[13]||(l[13]=(0,t.Lk)("strong",null,"原库位:",-1)),(0,t.eW)(" "+(0,u.v_)(e.originalLocation),1)]),(0,t.Lk)("p",null,[l[14]||(l[14]=(0,t.Lk)("strong",null,"状态:",-1)),l[15]||(l[15]=(0,t.eW)()),(0,t.Lk)("span",{class:(0,u.C4)(`status-${e.status}`)},(0,u.v_)(be(e.status)),3)])]),"pending"===e.status?((0,t.uX)(),(0,t.CE)("div",D,[(0,t.bF)((0,o.R1)(k.S2),{size:"small",type:"primary",onClick:l=>Ce(e),plain:""},{default:(0,t.k6)((()=>l[16]||(l[16]=[(0,t.eW)("扫卡板")]))),_:2},1032,["onClick"]),(0,t.bF)((0,o.R1)(k.S2),{size:"small",type:"info",onClick:l=>Le(e),disabled:!e.palletScanned,plain:""},{default:(0,t.k6)((()=>l[17]||(l[17]=[(0,t.eW)("扫库位")]))),_:2},1032,["onClick","disabled"]),(0,t.bF)((0,o.R1)(k.S2),{size:"small",type:"warning",onClick:l=>ye(e),disabled:!e.palletScanned,plain:""},{default:(0,t.k6)((()=>l[18]||(l[18]=[(0,t.eW)("扫Dock")]))),_:2},1032,["onClick","disabled"])])):(0,t.Q3)("",!0),"completed"===e.status?((0,t.uX)(),(0,t.CE)("div",X,[(0,t.bF)((0,o.R1)(d.tk),{color:"#67C23A",size:"18"},{default:(0,t.k6)((()=>[(0,t.bF)((0,o.R1)(b.m6F))])),_:1}),l[19]||(l[19]=(0,t.eW)(" 已出库 "))])):(0,t.Q3)("",!0)])),_:2},1032,["class"])))),128)),G.length||x.value?(0,t.Q3)("",!0):((0,t.uX)(),(0,t.CE)("p",V,"没有需要出库的订单"))]),(0,t.bF)((0,o.R1)(p.kZ),{modelValue:J.value,"onUpdate:modelValue":l[3]||(l[3]=e=>J.value=e),title:`扫描${"pallet"===le.value?"卡板":"location"===le.value?"库位":"Dock"}: ${te.value}`,width:"90%","append-to-body":!0,"close-on-click-modal":!1,onClosed:Fe},{footer:(0,t.k6)((()=>[(0,t.Lk)("span",j,[(0,t.bF)((0,o.R1)(k.S2),{onClick:l[2]||(l[2]=e=>J.value=!1)},{default:(0,t.k6)((()=>l[20]||(l[20]=[(0,t.eW)("取消")]))),_:1}),(0,t.bF)((0,o.R1)(k.S2),{type:"primary",onClick:_e},{default:(0,t.k6)((()=>l[21]||(l[21]=[(0,t.eW)("确认")]))),_:1})])])),default:(0,t.k6)((()=>[(0,t.bF)((0,o.R1)(r.WK),{modelValue:ee.value,"onUpdate:modelValue":l[1]||(l[1]=e=>ee.value=e),placeholder:`请输入模拟 ${"pallet"===le.value?"卡板":"location"===le.value?"库位":"Dock"} 码`,clearable:"",onKeyup:(0,n.jR)(_e,["enter"]),ref_key:"scanInputRef",ref:oe},null,8,["modelValue","placeholder"])])),_:1},8,["modelValue","title"]),Z.value?((0,t.uX)(),(0,t.CE)("div",$,[(0,t.bF)((0,o.R1)(k.S2),{type:"success",onClick:Se,style:{width:"100%"}},{default:(0,t.k6)((()=>l[22]||(l[22]=[(0,t.eW)("出库完成")]))),_:1})])):(0,t.Q3)("",!0)])):(0,t.Q3)("",!0),(0,t.bF)((0,o.R1)(p.kZ),{modelValue:ne.value,"onUpdate:modelValue":l[4]||(l[4]=e=>ne.value=e),title:"上传凭证照片",width:"90%","append-to-body":!0,"close-on-click-modal":!1,"show-close":!1},{footer:(0,t.k6)((()=>[(0,t.Lk)("span",M,[(0,t.bF)((0,o.R1)(k.S2),{onClick:Xe},{default:(0,t.k6)((()=>l[26]||(l[26]=[(0,t.eW)("取消")]))),_:1}),(0,t.bF)((0,o.R1)(k.S2),{type:"primary",onClick:De,disabled:!se.value.length},{default:(0,t.k6)((()=>l[27]||(l[27]=[(0,t.eW)("提交")]))),_:1},8,["disabled"])])])),default:(0,t.k6)((()=>[(0,t.Lk)("div",I,[se.value.length?((0,t.uX)(),(0,t.CE)("div",Q,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(se.value,((e,l)=>((0,t.uX)(),(0,t.CE)("div",{key:l,class:"photo-item"},[(0,t.Lk)("img",{src:e.url,alt:"凭证照片"},null,8,P),(0,t.Lk)("div",{class:"photo-delete",onClick:e=>We(l)},[(0,t.bF)((0,o.R1)(d.tk),null,{default:(0,t.k6)((()=>[(0,t.bF)((0,o.R1)(b.epd))])),_:1})],8,z)])))),128))])):((0,t.uX)(),(0,t.CE)("div",T,[(0,t.bF)((0,o.R1)(d.tk),null,{default:(0,t.k6)((()=>[(0,t.bF)((0,o.R1)(b.VIg))])),_:1}),l[23]||(l[23]=(0,t.Lk)("p",null,"请上传凭证照片",-1))])),(0,t.Lk)("div",B,[(0,t.bF)((0,o.R1)(R.j5),{ref_key:"uploadRef",ref:de,"auto-upload":!1,"show-file-list":!1,"on-change":we,multiple:!0,accept:"image/*"},{default:(0,t.k6)((()=>[(0,t.bF)((0,o.R1)(k.S2),{type:"primary",plain:""},{default:(0,t.k6)((()=>[(0,t.bF)((0,o.R1)(d.tk),null,{default:(0,t.k6)((()=>[(0,t.bF)((0,o.R1)(b._OO))])),_:1}),l[24]||(l[24]=(0,t.eW)(" 选择照片 "))])),_:1})])),_:1},512),(0,t.bF)((0,o.R1)(k.S2),{type:"success",onClick:Ke,plain:""},{default:(0,t.k6)((()=>[(0,t.bF)((0,o.R1)(d.tk),null,{default:(0,t.k6)((()=>[(0,t.bF)((0,o.R1)(b.i7d))])),_:1}),l[25]||(l[25]=(0,t.eW)(" 拍照 "))])),_:1})])])])),_:1},8,["modelValue"]),(0,t.bF)((0,o.R1)(p.kZ),{modelValue:ue.value,"onUpdate:modelValue":l[6]||(l[6]=e=>ue.value=e),title:"拍摄凭证照片",width:"90%","append-to-body":!0,"close-on-click-modal":!1},{default:(0,t.k6)((()=>[ce.value?((0,t.uX)(),(0,t.CE)("div",N,[(0,t.Lk)("video",{ref_key:"videoRef",ref:ie,autoplay:"",class:"camera-video"},null,512),(0,t.Lk)("div",A,[(0,t.bF)((0,o.R1)(k.S2),{type:"primary",onClick:Oe},{default:(0,t.k6)((()=>l[28]||(l[28]=[(0,t.eW)("拍照")]))),_:1}),(0,t.bF)((0,o.R1)(k.S2),{onClick:l[5]||(l[5]=e=>ue.value=!1)},{default:(0,t.k6)((()=>l[29]||(l[29]=[(0,t.eW)("取消")]))),_:1})])])):((0,t.uX)(),(0,t.CE)("div",Y,[(0,t.bF)((0,o.R1)(d.tk),null,{default:(0,t.k6)((()=>[(0,t.bF)((0,o.R1)(b.BFW))])),_:1}),l[30]||(l[30]=(0,t.Lk)("p",null,"无法访问摄像头，请检查权限或使用上传功能",-1))]))])),_:1},8,["modelValue"])])])]))}};var x=a(6262);const H=(0,x.A)(Z,[["__scopeId","data-v-35a4f602"]]),q=H}}]);
//# sourceMappingURL=9595.2e1e6067.js.map