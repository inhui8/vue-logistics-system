"use strict";(self["webpackChunkvue_logistics_system"]=self["webpackChunkvue_logistics_system"]||[]).push([[4194],{4194:(e,l,a)=>{a.r(l),a.d(l,{default:()=>v});var t=a(641),u=a(33),o=a(3751),d=a(953),r=a(163),n=a(7918);const i={class:"app-container"},s={class:"flex justify-between mb-4"},c={class:"dialog-footer"},p={class:"dialog-footer"},m={__name:"EmailTemplate",setup(e){const l=(0,d.KR)(!0),a=(0,d.KR)([]),m=(0,d.KR)(0),b=(0,d.KR)(!1),g=(0,d.KR)(""),v=(0,d.KR)(null),k=(0,d.KR)(!1),f=(0,d.KR)(null),F=(0,d.KR)(null),_=(0,d.KR)([]),h=(0,d.Kh)({pageNo:1,pageSize:10}),w=(0,d.KR)({id:void 0,code:"",name:"",accountId:void 0,subject:"",content:"",status:0,remark:""}),y=(0,d.Kh)({code:[{required:!0,message:"模板编码不能为空",trigger:"blur"}],name:[{required:!0,message:"模板名称不能为空",trigger:"blur"}],accountId:[{required:!0,message:"发送账号不能为空",trigger:"change"}],subject:[{required:!0,message:"邮件主题不能为空",trigger:"blur"}],content:[{required:!0,message:"模板内容不能为空",trigger:"blur"}],status:[{required:!0,message:"状态不能为空",trigger:"blur"}]}),V=(0,d.KR)({mail:"",templateId:void 0,params:""}),R=(0,d.Kh)({mail:[{required:!0,message:"收件邮箱不能为空",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:["blur","change"]}],params:[{validator:(e,l,a)=>{if(l)try{JSON.parse(l),a()}catch(t){a(new Error("请输入有效的 JSON 格式"))}else a()},trigger:"blur"}]}),C=()=>{_.value=[{value:1,label:"sender1@example.com"},{value:2,label:"sender2@example.com"},{value:3,label:"no-ssl@example.com"},{value:4,label:"another@domain.net"}]},S=()=>{l.value=!0,console.log("Fetching template list with params:",h),setTimeout((()=>{const e=[{id:101,code:"ORDER_CONFIRM",name:"订单确认邮件",accountId:1,accountMail:"sender1@example.com",subject:"您的订单 {orderNo} 已确认",content:"尊敬的 {customerName}，您的订单 {orderNo} 已确认，感谢您的购买！",status:0,createTime:new Date(Date.now()-864e5),remark:"给客户发送订单确认信息"},{id:102,code:"PASSWORD_RESET",name:"密码重置邮件",accountId:2,accountMail:"sender2@example.com",subject:"密码重置请求",content:"请点击以下链接重置您的密码：{resetLink}",status:0,createTime:new Date(Date.now()-1728e5),remark:"用户请求重置密码"},{id:103,code:"PROMOTION_NEWS",name:"推广活动",accountId:1,accountMail:"sender1@example.com",subject:"最新优惠活动！",content:"亲爱的用户，我们有新的优惠活动，详情请见：{promoLink}",status:1,createTime:new Date(Date.now()-2592e5),remark:"节日推广"}],t=(h.pageNo-1)*h.pageSize,u=t+h.pageSize;a.value=e.slice(t,u),m.value=e.length,l.value=!1}),500)},I=()=>{w.value={id:void 0,code:"",name:"",accountId:void 0,subject:"",content:"",status:0,remark:""},v.value?.resetFields()},x=()=>{I(),C(),g.value="新增邮件模板",b.value=!0},K=e=>{I(),C(),w.value={...e},g.value="修改邮件模板",b.value=!0},N=()=>{b.value=!1,I()},W=()=>{v.value?.validate((async e=>{if(e){console.log("Submitting template form:",w.value);const e=!!w.value.id;r.nk.success(e?"修改成功":"新增成功"),b.value=!1,S()}else console.log("Template form validation failed")}))},j=e=>{n.s.confirm(`确定要删除模板 "${e.name}" (编码: ${e.code}) 吗？`,"提示",{type:"warning"}).then((()=>{console.log("Deleting template:",e.id),r.nk.success("删除成功"),S()})).catch((()=>{}))},U=e=>{F.value=e,V.value={mail:"",templateId:e.id,params:""},f.value?.resetFields(),k.value=!0},T=()=>{f.value?.validate((async e=>{if(e){let e={};try{e=V.value.params?JSON.parse(V.value.params):{}}catch(l){}const a={mail:V.value.mail,templateId:V.value.templateId,templateParams:e};console.log("Sending test email with payload:",a),r.nk.info(`正在向 ${V.value.mail} 发送测试邮件...`),setTimeout((()=>{r.nk.success("测试邮件已发送（模拟）")}),1e3),k.value=!1}}))};return(0,t.sV)((()=>{S(),C()})),(e,d)=>{const r=(0,t.g2)("el-button"),n=(0,t.g2)("el-table-column"),C=(0,t.g2)("el-tag"),I=(0,t.g2)("el-table"),z=(0,t.g2)("el-pagination"),D=(0,t.g2)("el-card"),O=(0,t.g2)("el-input"),E=(0,t.g2)("el-form-item"),L=(0,t.g2)("el-col"),q=(0,t.g2)("el-row"),M=(0,t.g2)("el-option"),J=(0,t.g2)("el-select"),P=(0,t.g2)("el-radio"),X=(0,t.g2)("el-radio-group"),$=(0,t.g2)("el-form"),A=(0,t.g2)("el-dialog"),G=(0,t.gN)("loading");return(0,t.uX)(),(0,t.CE)("div",i,[(0,t.bF)(D,{shadow:"never"},{default:(0,t.k6)((()=>[(0,t.Lk)("div",s,[(0,t.bF)(r,{type:"primary",icon:"el-icon-plus",onClick:x},{default:(0,t.k6)((()=>d[14]||(d[14]=[(0,t.eW)("新增模板")]))),_:1}),d[15]||(d[15]=(0,t.Lk)("div",null,null,-1))]),(0,t.bo)(((0,t.uX)(),(0,t.Wv)(I,{data:a.value},{default:(0,t.k6)((()=>[(0,t.bF)(n,{label:"模板编码",align:"center",prop:"code"}),(0,t.bF)(n,{label:"模板名称",align:"center",prop:"name",width:"180"}),(0,t.bF)(n,{label:"邮件主题",align:"center",prop:"subject","show-overflow-tooltip":""}),(0,t.bF)(n,{label:"发送邮箱",align:"center",prop:"accountMail",width:"180"}),(0,t.bF)(n,{label:"状态",align:"center",prop:"status",width:"80"},{default:(0,t.k6)((e=>[(0,t.bF)(C,{type:0===e.row.status?"success":"danger"},{default:(0,t.k6)((()=>[(0,t.eW)((0,u.v_)(0===e.row.status?"启用":"禁用"),1)])),_:2},1032,["type"])])),_:1}),(0,t.bF)(n,{label:"创建时间",align:"center",prop:"createTime",width:"180"},{default:(0,t.k6)((e=>[(0,t.Lk)("span",null,(0,u.v_)(e.row.createTime?new Date(e.row.createTime).toLocaleString():""),1)])),_:1}),(0,t.bF)(n,{label:"操作",align:"center",width:"200","class-name":"small-padding fixed-width"},{default:(0,t.k6)((e=>[(0,t.bF)(r,{link:"",type:"primary",icon:"el-icon-edit",onClick:l=>K(e.row)},{default:(0,t.k6)((()=>d[16]||(d[16]=[(0,t.eW)("修改")]))),_:2},1032,["onClick"]),(0,t.bF)(r,{link:"",type:"primary",icon:"el-icon-delete",onClick:l=>j(e.row)},{default:(0,t.k6)((()=>d[17]||(d[17]=[(0,t.eW)("删除")]))),_:2},1032,["onClick"]),(0,t.bF)(r,{link:"",type:"primary",icon:"el-icon-s-promotion",onClick:l=>U(e.row)},{default:(0,t.k6)((()=>d[18]||(d[18]=[(0,t.eW)("测试发送")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[G,l.value]]),(0,t.bo)((0,t.bF)(z,{"current-page":h.pageNo,"onUpdate:currentPage":d[0]||(d[0]=e=>h.pageNo=e),"page-size":h.pageSize,"onUpdate:pageSize":d[1]||(d[1]=e=>h.pageSize=e),total:m.value,"page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:S,onCurrentChange:S,class:"mt-4 justify-end"},null,8,["current-page","page-size","total"]),[[o.aG,m.value>0]])])),_:1}),(0,t.bF)(A,{title:g.value,modelValue:b.value,"onUpdate:modelValue":d[9]||(d[9]=e=>b.value=e),width:"700px","append-to-body":""},{footer:(0,t.k6)((()=>[(0,t.Lk)("div",c,[(0,t.bF)(r,{type:"primary",onClick:W},{default:(0,t.k6)((()=>d[21]||(d[21]=[(0,t.eW)("确 定")]))),_:1}),(0,t.bF)(r,{onClick:N},{default:(0,t.k6)((()=>d[22]||(d[22]=[(0,t.eW)("取 消")]))),_:1})])])),default:(0,t.k6)((()=>[(0,t.bF)($,{ref_key:"formRef",ref:v,model:w.value,rules:y,"label-width":"100px"},{default:(0,t.k6)((()=>[(0,t.bF)(q,{gutter:20},{default:(0,t.k6)((()=>[(0,t.bF)(L,{span:12},{default:(0,t.k6)((()=>[(0,t.bF)(E,{label:"模板编码",prop:"code"},{default:(0,t.k6)((()=>[(0,t.bF)(O,{modelValue:w.value.code,"onUpdate:modelValue":d[2]||(d[2]=e=>w.value.code=e),placeholder:"请输入模板编码"},null,8,["modelValue"])])),_:1})])),_:1}),(0,t.bF)(L,{span:12},{default:(0,t.k6)((()=>[(0,t.bF)(E,{label:"模板名称",prop:"name"},{default:(0,t.k6)((()=>[(0,t.bF)(O,{modelValue:w.value.name,"onUpdate:modelValue":d[3]||(d[3]=e=>w.value.name=e),placeholder:"请输入模板名称"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),(0,t.bF)(q,{gutter:20},{default:(0,t.k6)((()=>[(0,t.bF)(L,{span:12},{default:(0,t.k6)((()=>[(0,t.bF)(E,{label:"邮件主题",prop:"subject"},{default:(0,t.k6)((()=>[(0,t.bF)(O,{modelValue:w.value.subject,"onUpdate:modelValue":d[4]||(d[4]=e=>w.value.subject=e),placeholder:"请输入邮件主题"},null,8,["modelValue"])])),_:1})])),_:1}),(0,t.bF)(L,{span:12},{default:(0,t.k6)((()=>[(0,t.bF)(E,{label:"发送账号",prop:"accountId"},{default:(0,t.k6)((()=>[(0,t.bF)(J,{modelValue:w.value.accountId,"onUpdate:modelValue":d[5]||(d[5]=e=>w.value.accountId=e),placeholder:"请选择发送账号",style:{width:"100%"}},{default:(0,t.k6)((()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(_.value,(e=>((0,t.uX)(),(0,t.Wv)(M,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1}),(0,t.bF)(E,{label:"模板内容",prop:"content"},{default:(0,t.k6)((()=>[(0,t.bF)(O,{modelValue:w.value.content,"onUpdate:modelValue":d[6]||(d[6]=e=>w.value.content=e),type:"textarea",rows:6,placeholder:"请输入模板内容，使用 {变量名} 作为占位符"},null,8,["modelValue"])])),_:1}),(0,t.bF)(q,{gutter:20},{default:(0,t.k6)((()=>[(0,t.bF)(L,{span:12},{default:(0,t.k6)((()=>[(0,t.bF)(E,{label:"状态",prop:"status"},{default:(0,t.k6)((()=>[(0,t.bF)(X,{modelValue:w.value.status,"onUpdate:modelValue":d[7]||(d[7]=e=>w.value.status=e)},{default:(0,t.k6)((()=>[(0,t.bF)(P,{label:0},{default:(0,t.k6)((()=>d[19]||(d[19]=[(0,t.eW)("启用")]))),_:1}),(0,t.bF)(P,{label:1},{default:(0,t.k6)((()=>d[20]||(d[20]=[(0,t.eW)("禁用")]))),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1}),(0,t.bF)(E,{label:"备注",prop:"remark"},{default:(0,t.k6)((()=>[(0,t.bF)(O,{modelValue:w.value.remark,"onUpdate:modelValue":d[8]||(d[8]=e=>w.value.remark=e),type:"textarea",rows:2,placeholder:"请输入备注"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["title","modelValue"]),(0,t.bF)(A,{title:"测试发送邮件",modelValue:k.value,"onUpdate:modelValue":d[13]||(d[13]=e=>k.value=e),width:"600px","append-to-body":""},{footer:(0,t.k6)((()=>[(0,t.Lk)("div",p,[(0,t.bF)(r,{type:"primary",onClick:T},{default:(0,t.k6)((()=>d[23]||(d[23]=[(0,t.eW)("发 送")]))),_:1}),(0,t.bF)(r,{onClick:d[12]||(d[12]=e=>k.value=!1)},{default:(0,t.k6)((()=>d[24]||(d[24]=[(0,t.eW)("取 消")]))),_:1})])])),default:(0,t.k6)((()=>[(0,t.bF)($,{ref_key:"testFormRef",ref:f,model:V.value,rules:R,"label-width":"100px"},{default:(0,t.k6)((()=>[(0,t.bF)(E,{label:"模板编码"},{default:(0,t.k6)((()=>[(0,t.bF)(O,{value:F.value?.code,disabled:""},null,8,["value"])])),_:1}),(0,t.bF)(E,{label:"收件邮箱",prop:"mail"},{default:(0,t.k6)((()=>[(0,t.bF)(O,{modelValue:V.value.mail,"onUpdate:modelValue":d[10]||(d[10]=e=>V.value.mail=e),placeholder:"请输入收件邮箱"},null,8,["modelValue"])])),_:1}),(0,t.bF)(E,{label:"模板参数",prop:"params"},{default:(0,t.k6)((()=>[(0,t.bF)(O,{modelValue:V.value.params,"onUpdate:modelValue":d[11]||(d[11]=e=>V.value.params=e),type:"textarea",rows:4,placeholder:'请输入模板参数，JSON 格式，例如：{"name": "张三", "orderNo": "12345"}'},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue"])])}}};var b=a(6262);const g=(0,b.A)(m,[["__scopeId","data-v-671014d1"]]),v=g}}]);
//# sourceMappingURL=4194.e66cbea2.js.map