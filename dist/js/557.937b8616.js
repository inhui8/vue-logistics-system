"use strict";(self["webpackChunkvue_logistics_system"]=self["webpackChunkvue_logistics_system"]||[]).push([[557],{2557:(e,l,a)=>{a.r(l),a.d(l,{default:()=>v});var t=a(641),o=a(33),r=a(3751),i=a(953),p=a(163),s=a(8548);const d={class:"quote-compare-container"},u={style:{"margin-bottom":"10px",display:"flex","justify-content":"flex-end"}},n={style:{"margin-bottom":"15px"}},c={class:"compared-suppliers-info",style:{"margin-bottom":"20px",padding:"15px","background-color":"#f4f4f5","border-radius":"4px"}},b={key:0,style:{"text-align":"center",padding:"20px",color:"#909399"}},m={__name:"QuoteComparisonHistory",setup(e){const l=(0,i.KR)([]),a=(0,i.KR)([]),m={},f=[{value:"pickup",label:"提柜"},{value:"delivery",label:"派送"}],h=[{value:"FBA",label:"FBA",tag:"success"},{value:"FBX",label:"FBX",tag:"primary"},{value:"直送",label:"直送",tag:"warning"},{value:"拆柜",label:"拆柜",tag:"info"},{value:"提柜",label:"提柜",tag:"danger"}],v=(e=50,t=5)=>{const o=[];for(let l=1;l<=t;l++){const e=`supplier_${String.fromCharCode(64+l)}`,a=l%2===0?"pickup":"delivery";o.push({id:e,name:`供应商${String.fromCharCode(64+l)}`,type:a}),m[e]=parseFloat((2*Math.random()+3).toFixed(1))}l.value=o;const r=["LAX-FBA","LGB-FBA","EWR-FBA","SAV-FBA","DAL-FBA"],i=["active","pending","expired"],p=["FBA","FBX","直送","拆柜","提柜"],s=[],d=new Date;for(let l=0;l<e;l++){const e=o[l%o.length],a=r[l%r.length],u=p[l%p.length],n=`${a} ${u} ${"pickup"===e.type?"提柜":"派送"} (${l%3===0?"含燃油":"不含燃油"})`,c=i[l%i.length],b=new Date(d.getTime()-Math.floor(90*Math.random()*24*60*60*1e3));let m,f;m=new Date(b.getTime()+Math.floor(7*Math.random()*24*60*60*1e3)),f=new Date(m.getFullYear()+1,m.getMonth(),m.getDate()),"expired"===c?(f=new Date(d.getTime()-24*Math.floor(30*Math.random()+1)*60*60*1e3),m>f&&(m=new Date(f.getTime()-31536e6))):"pending"===c?(m=new Date(d.getTime()+24*Math.floor(14*Math.random()+1)*60*60*1e3),f=new Date(m.getFullYear()+1,m.getMonth(),m.getDate())):(m=new Date(d.getTime()-24*Math.floor(60*Math.random())*60*60*1e3),f=new Date(m.getFullYear()+1,m.getMonth(),m.getDate()));let h=[];const v=Math.floor(8*Math.random())+5,g=["ONT9","HOU2","XUS8","FTW1","FTW2","RIC1","RIC2","RIC3","BFI1","BFI3","XUSD","BF14","BF15","PHX3","BFI7","SEA6","SEA8","MKE1"],F="Amazon";let w=500+l%t*50+200*(Math.random()-.5);const y=new Set;for(let t=0;t<v;t++){let e=g[Math.floor(Math.random()*g.length)];while(y.has(e))e=g[Math.floor(Math.random()*g.length)];y.add(e),h.push({id:`detail_${l+1}_${t+1}`,platform:F,warehouseCode:e,price:parseFloat((w+150*(Math.random()-.4)).toFixed(2))})}s.push({id:`fq_${l+1}`,supplierId:e.id,supplierName:e.name,supplierType:e.type,serviceDescription:n,quoteType:u,validFrom:m.toISOString().split("T")[0],validTo:f.toISOString().split("T")[0],submittedAt:b.toLocaleString(),status:c,details:h})}a.value=s},g=(0,i.KR)("fixed"),F=(0,i.KR)(null),w=(0,i.Kh)({supplierId:null,serviceDescription:"",status:"active",supplierType:"",quoteType:""}),y=(0,i.KR)([]),k=(0,i.KR)([]),_=(0,i.KR)(!1),T=(0,i.Kh)({comparedSuppliers:[],comparisonTableData:[]}),C=()=>{console.log("Fetching fixed quotes with filter:",w);let e=a.value;w.supplierId&&(e=e.filter((e=>e.supplierId===w.supplierId))),w.serviceDescription&&(e=e.filter((e=>e.serviceDescription.toLowerCase().includes(w.serviceDescription.toLowerCase())))),w.status&&(e="expired"===w.status?e.filter((e=>"expired"===e.status||"ended"===e.status)):e.filter((e=>e.status===w.status))),w.supplierType&&(e=e.filter((e=>e.supplierType===w.supplierType))),w.quoteType&&(e=e.filter((e=>e.quoteType===w.quoteType))),y.value=e,k.value=[],F.value&&F.value.clearSelection()},x=()=>{w.supplierId=null,w.serviceDescription="",w.status="active",w.supplierType="",w.quoteType="",C()},D=e=>{k.value=e},I=()=>{if(k.value.length<2)return void p.nk.warning("请至少选择两个报价进行对比");console.log("Comparing selected quotes:",k.value);const e=k.value,a=[...new Set(e.map((e=>e.supplierId)))];T.comparedSuppliers=a.map((e=>({id:e,name:l.value.find((l=>l.id===e))?.name||e,rating:m[e]||0}))).sort(((e,l)=>e.name.localeCompare(l.name)));const t=new Map;e.forEach((e=>{e.details?.forEach((e=>{const l=`${e.platform}-${e.warehouseCode}`;t.has(l)||t.set(l,{platform:e.platform,warehouseCode:e.warehouseCode})}))}));const o=[];t.forEach((l=>{const a={platform:l.platform,warehouseCode:l.warehouseCode,supplierPrices:{},lowestPrice:1/0,lowestSupplierId:null};let t=!1,r=0;e.forEach((e=>{const o=e.details?.find((e=>e.platform===l.platform&&e.warehouseCode===l.warehouseCode));void 0!==o?.price&&(a.supplierPrices[e.supplierId]=o.price,t=!0,r++,o.price<a.lowestPrice&&(a.lowestPrice=o.price,a.lowestSupplierId=e.supplierId))})),t&&r>=2&&(a.lowestPrice===1/0&&(a.lowestPrice=null),o.push(a))})),T.comparisonTableData=o.sort(((e,l)=>e.platform!==l.platform?e.platform.localeCompare(l.platform):e.warehouseCode.localeCompare(l.warehouseCode))),_.value=!0,console.log("Comparison Result:",T)},M=()=>{_.value=!1},S=(e,l,a)=>{const t=e.supplierPrices[a],o=l.supplierPrices[a];return void 0===t&&void 0===o?0:void 0===t?1:void 0===o?-1:t-o},V=(e,l)=>e.lowestSupplierId===l&&void 0!==e.supplierPrices[l],B=e=>{switch(e){case"active":return"success";case"pending":return"warning";case"expired":case"ended":return"info";case"rejected":return"danger";default:return"info"}},A=e=>{switch(e){case"active":return"生效中";case"pending":return"待生效";case"expired":return"已过期";case"ended":return"已结束";case"rejected":return"已拒绝";default:return e}},L=e=>f.find((l=>l.value===e))?.label||e,q=e=>h.find((l=>l.value===e))?.tag||"info";return(0,t.sV)((()=>{v(),C()})),(e,a)=>{const p=(0,t.g2)("el-option"),m=(0,t.g2)("el-select"),f=(0,t.g2)("el-form-item"),h=(0,t.g2)("el-input"),v=(0,t.g2)("el-button"),X=(0,t.g2)("el-form"),W=(0,t.g2)("el-table-column"),P=(0,t.g2)("el-tag"),R=(0,t.g2)("el-table"),E=(0,t.g2)("el-icon"),K=(0,t.g2)("el-rate"),U=(0,t.g2)("el-col"),$=(0,t.g2)("el-row"),z=(0,t.g2)("el-tab-pane"),O=(0,t.g2)("el-empty"),j=(0,t.g2)("el-tabs"),G=(0,t.g2)("el-card");return(0,t.uX)(),(0,t.CE)("div",d,[(0,t.bF)(G,null,{header:(0,t.k6)((()=>a[6]||(a[6]=[(0,t.Lk)("div",{class:"card-header"},[(0,t.Lk)("span",null,"供应商报价对比")],-1)]))),default:(0,t.k6)((()=>[(0,t.bF)(j,{modelValue:g.value,"onUpdate:modelValue":a[5]||(a[5]=e=>g.value=e),class:"quote-tabs"},{default:(0,t.k6)((()=>[(0,t.bF)(z,{label:"固定报价对比",name:"fixed"},{default:(0,t.k6)((()=>[(0,t.bo)((0,t.Lk)("div",null,[(0,t.bF)(X,{inline:!0,model:w,class:"filter-form"},{default:(0,t.k6)((()=>[(0,t.bF)(f,{label:"供应商"},{default:(0,t.k6)((()=>[(0,t.bF)(m,{modelValue:w.supplierId,"onUpdate:modelValue":a[0]||(a[0]=e=>w.supplierId=e),placeholder:"选择供应商",clearable:"",filterable:"",style:{width:"250px"}},{default:(0,t.k6)((()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(l.value,(e=>((0,t.uX)(),(0,t.Wv)(p,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,t.bF)(f,{label:"供应商类型"},{default:(0,t.k6)((()=>[(0,t.bF)(m,{modelValue:w.supplierType,"onUpdate:modelValue":a[1]||(a[1]=e=>w.supplierType=e),placeholder:"选择供应商类型",clearable:"",style:{width:"150px"}},{default:(0,t.k6)((()=>[(0,t.bF)(p,{label:"提柜",value:"pickup"}),(0,t.bF)(p,{label:"派送",value:"delivery"})])),_:1},8,["modelValue"])])),_:1}),(0,t.bF)(f,{label:"报价类型"},{default:(0,t.k6)((()=>[(0,t.bF)(m,{modelValue:w.quoteType,"onUpdate:modelValue":a[2]||(a[2]=e=>w.quoteType=e),placeholder:"选择报价类型",clearable:"",style:{width:"150px"}},{default:(0,t.k6)((()=>[(0,t.bF)(p,{label:"FBA",value:"FBA"}),(0,t.bF)(p,{label:"FBX",value:"FBX"}),(0,t.bF)(p,{label:"直送",value:"直送"}),(0,t.bF)(p,{label:"拆柜",value:"拆柜"}),(0,t.bF)(p,{label:"提柜",value:"pickup"})])),_:1},8,["modelValue"])])),_:1}),(0,t.bF)(f,{label:"服务描述"},{default:(0,t.k6)((()=>[(0,t.bF)(h,{modelValue:w.serviceDescription,"onUpdate:modelValue":a[3]||(a[3]=e=>w.serviceDescription=e),placeholder:"输入服务/线路关键字",clearable:"",style:{width:"250px"}},null,8,["modelValue"])])),_:1}),(0,t.bF)(f,{label:"状态"},{default:(0,t.k6)((()=>[(0,t.bF)(m,{modelValue:w.status,"onUpdate:modelValue":a[4]||(a[4]=e=>w.status=e),placeholder:"选择状态",clearable:"",style:{width:"150px"}},{default:(0,t.k6)((()=>[(0,t.bF)(p,{label:"生效中",value:"active"}),(0,t.bF)(p,{label:"待生效",value:"pending"}),(0,t.bF)(p,{label:"已过期/结束",value:"expired"})])),_:1},8,["modelValue"])])),_:1}),(0,t.bF)(f,null,{default:(0,t.k6)((()=>[(0,t.bF)(v,{type:"primary",onClick:C},{default:(0,t.k6)((()=>a[7]||(a[7]=[(0,t.eW)("查询")]))),_:1}),(0,t.bF)(v,{onClick:x},{default:(0,t.k6)((()=>a[8]||(a[8]=[(0,t.eW)("重置")]))),_:1})])),_:1})])),_:1},8,["model"]),(0,t.Lk)("div",u,[(0,t.bF)(v,{type:"primary",disabled:k.value.length<2,onClick:I},{default:(0,t.k6)((()=>[(0,t.eW)(" 对比选中报价 ("+(0,o.v_)(k.value.length)+") ",1)])),_:1},8,["disabled"])]),(0,t.bF)(R,{data:y.value,style:{width:"100%"},border:"",size:"small",onSelectionChange:D,ref_key:"fixedQuoteTableRef",ref:F},{default:(0,t.k6)((()=>[(0,t.bF)(W,{type:"selection",width:"55"}),(0,t.bF)(W,{prop:"supplierName",label:"供应商",width:"200","show-overflow-tooltip":""}),(0,t.bF)(W,{prop:"supplierType",label:"供应商类型",width:"100"},{default:(0,t.k6)((e=>[(0,t.bF)(P,{size:"small",type:"delivery"===e.row.supplierType?"success":"warning"},{default:(0,t.k6)((()=>[(0,t.eW)((0,o.v_)(L(e.row.supplierType)),1)])),_:2},1032,["type"])])),_:1}),(0,t.bF)(W,{prop:"quoteType",label:"报价类型",width:"100"},{default:(0,t.k6)((e=>[(0,t.bF)(P,{size:"small",type:q(e.row.quoteType)},{default:(0,t.k6)((()=>[(0,t.eW)((0,o.v_)(e.row.quoteType),1)])),_:2},1032,["type"])])),_:1}),(0,t.bF)(W,{prop:"serviceDescription",label:"服务/线路描述","min-width":"200","show-overflow-tooltip":""}),(0,t.bF)(W,{prop:"validFrom",label:"生效开始日期",width:"120"}),(0,t.bF)(W,{prop:"validTo",label:"生效结束日期",width:"120"}),(0,t.bF)(W,{prop:"status",label:"状态",width:"100"},{default:(0,t.k6)((e=>[(0,t.bF)(P,{size:"small",type:B(e.row.status)},{default:(0,t.k6)((()=>[(0,t.eW)((0,o.v_)(A(e.row.status)),1)])),_:2},1032,["type"])])),_:1}),(0,t.bF)(W,{prop:"detailsCount",label:"仓库数",width:"80"},{default:(0,t.k6)((e=>[(0,t.eW)((0,o.v_)(e.row.details?.length||0),1)])),_:1})])),_:1},8,["data"])],512),[[r.aG,!_.value]]),(0,t.bo)((0,t.Lk)("div",null,[(0,t.Lk)("div",n,[(0,t.bF)(v,{type:"primary",link:"",onClick:M},{default:(0,t.k6)((()=>[(0,t.bF)(E,null,{default:(0,t.k6)((()=>[(0,t.bF)((0,i.R1)(s.nkM))])),_:1}),a[9]||(a[9]=(0,t.eW)(" 返回列表"))])),_:1}),a[10]||(a[10]=(0,t.Lk)("span",{style:{"margin-left":"15px","font-weight":"bold"}},"固定报价对比结果",-1))]),(0,t.Lk)("div",c,[a[11]||(a[11]=(0,t.Lk)("h4",{style:{"margin-top":"0","margin-bottom":"10px"}},"参与对比的供应商：",-1)),(0,t.bF)($,{gutter:20},{default:(0,t.k6)((()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(T.comparedSuppliers,(e=>((0,t.uX)(),(0,t.Wv)(U,{span:6,key:e.id},{default:(0,t.k6)((()=>[(0,t.Lk)("span",null,(0,o.v_)(e.name),1),(0,t.bF)(K,{modelValue:e.rating,"onUpdate:modelValue":l=>e.rating=l,disabled:"","show-score":"","text-color":"#ff9900","score-template":"{value} 分",size:"small",style:{"margin-left":"10px"}},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024)))),128))])),_:1})]),a[12]||(a[12]=(0,t.Lk)("h4",{style:{"margin-bottom":"10px"}},"仓库报价对比明细：",-1)),(0,t.bF)(R,{data:T.comparisonTableData,border:"",stripe:"",style:{width:"100%"},size:"small"},{default:(0,t.k6)((()=>[(0,t.bF)(W,{prop:"platform",label:"平台名称",width:"100",fixed:"left"}),(0,t.bF)(W,{prop:"warehouseCode",label:"仓库代码",width:"120",fixed:"left"}),((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(T.comparedSuppliers,(e=>((0,t.uX)(),(0,t.Wv)(W,{key:e.id,label:e.name+" (USD)",prop:"supplierPrices."+e.id,align:"right",width:"150",sortable:"","sort-method":(l,a)=>S(l,a,e.id)},{default:(0,t.k6)((l=>[(0,t.Lk)("span",{style:(0,o.Tr)({color:V(l.row,e.id)?"red":"inherit",fontWeight:V(l.row,e.id)?"bold":"normal"})},(0,o.v_)(void 0!==l.row.supplierPrices[e.id]?l.row.supplierPrices[e.id].toFixed(2):"-"),5)])),_:2},1032,["label","prop","sort-method"])))),128))])),_:1},8,["data"]),0===T.comparisonTableData.length?((0,t.uX)(),(0,t.CE)("div",b," 选中的报价中没有共同包含的仓库明细可供对比。 ")):(0,t.Q3)("",!0)],512),[[r.aG,_.value]])])),_:1}),(0,t.bF)(z,{label:"询价对比",name:"inquiry",disabled:""},{default:(0,t.k6)((()=>[(0,t.bF)(O,{description:"询价对比功能待开发"})])),_:1}),(0,t.bF)(z,{label:"竞价对比",name:"bidding",disabled:""},{default:(0,t.k6)((()=>[(0,t.bF)(O,{description:"竞价对比功能待开发"})])),_:1})])),_:1},8,["modelValue"])])),_:1})])}}};var f=a(6262);const h=(0,f.A)(m,[["__scopeId","data-v-76acb12e"]]),v=h}}]);
//# sourceMappingURL=557.937b8616.js.map