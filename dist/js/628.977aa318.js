"use strict";(self["webpackChunkvue_logistics_system"]=self["webpackChunkvue_logistics_system"]||[]).push([[628],{616:(e,l,a)=>{a.d(l,{A:()=>v});var o=a(641);const i={class:"upload-pod-container"},s={class:"form-item"},t={class:"upload-area"},n={class:"upload-boxes"},d={class:"upload-box"},u={class:"upload-box"},p={class:"dialog-footer"};function r(e,l,a,r,m,c){const h=(0,o.g2)("el-date-picker"),b=(0,o.g2)("el-button"),k=(0,o.g2)("el-dialog");return(0,o.uX)(),(0,o.Wv)(k,{title:"更新签收",modelValue:r.dialogVisible,"onUpdate:modelValue":l[5]||(l[5]=e=>r.dialogVisible=e),width:"600px","close-on-click-modal":!1,onClose:r.handleClose},{footer:(0,o.k6)((()=>[(0,o.Lk)("div",p,[(0,o.bF)(b,{onClick:r.handleClose},{default:(0,o.k6)((()=>l[10]||(l[10]=[(0,o.eW)("取消")]))),_:1},8,["onClick"]),(0,o.bF)(b,{type:"primary",onClick:r.handleSubmit,loading:r.uploading},{default:(0,o.k6)((()=>l[11]||(l[11]=[(0,o.eW)("确定")]))),_:1},8,["onClick","loading"])])])),default:(0,o.k6)((()=>[(0,o.Lk)("div",i,[(0,o.Lk)("div",s,[l[6]||(l[6]=(0,o.Lk)("label",{class:"label"},"签收时间：",-1)),(0,o.bF)(h,{modelValue:r.receiveTime,"onUpdate:modelValue":l[0]||(l[0]=e=>r.receiveTime=e),type:"datetime",placeholder:"请选择日期时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",class:"date-picker"},null,8,["modelValue"])]),(0,o.Lk)("div",t,[l[9]||(l[9]=(0,o.Lk)("label",{class:"label"},"POD文件：",-1)),(0,o.Lk)("div",n,[(0,o.Lk)("div",d,[(0,o.Lk)("div",{class:"upload-content",onClick:l[1]||(l[1]=(...e)=>r.handleIsaUpload&&r.handleIsaUpload(...e))},l[7]||(l[7]=[(0,o.Lk)("i",{class:"el-icon-upload"},null,-1),(0,o.Lk)("p",{class:"upload-text"},"将ISA文件拖到此处，或点击上传",-1)])),(0,o.Lk)("input",{ref:"isaFileInput",type:"file",style:{display:"none"},onChange:l[2]||(l[2]=(...e)=>r.handleIsaFileChange&&r.handleIsaFileChange(...e)),accept:".pdf,.jpg,.jpeg,.png"},null,544)]),(0,o.Lk)("div",u,[(0,o.Lk)("div",{class:"upload-content",onClick:l[3]||(l[3]=(...e)=>r.handleBolUpload&&r.handleBolUpload(...e))},l[8]||(l[8]=[(0,o.Lk)("i",{class:"el-icon-upload"},null,-1),(0,o.Lk)("p",{class:"upload-text"},"将BOL文件拖到此处，或点击上传",-1)])),(0,o.Lk)("input",{ref:"bolFileInput",type:"file",style:{display:"none"},onChange:l[4]||(l[4]=(...e)=>r.handleBolFileChange&&r.handleBolFileChange(...e)),accept:".pdf,.jpg,.jpeg,.png"},null,544)])])])])])),_:1},8,["modelValue","onClose"])}var m=a(953),c=a(163);const h={name:"UploadPodDialog",props:{visible:{type:Boolean,default:!1}},emits:["update:visible","submit","cancel"],setup(e,{emit:l}){const a=(0,m.KR)(e.visible),i=(0,m.KR)(""),s=(0,m.KR)(null),t=(0,m.KR)(null),n=(0,m.KR)(null),d=(0,m.KR)(null),u=(0,m.KR)(!1);(0,o.wB)((()=>e.visible),(e=>{a.value=e}));const p=()=>{s.value.click()},r=()=>{t.value.click()},h=e=>{const l=e.target.files[0];l&&(n.value=l,c.nk.success(`已选择ISA文件: ${l.name}`))},b=e=>{const l=e.target.files[0];l&&(d.value=l,c.nk.success(`已选择BOL文件: ${l.name}`))},k=()=>{a.value=!1,l("update:visible",!1),l("cancel"),i.value="",n.value=null,d.value=null,s.value&&(s.value.value=""),t.value&&(t.value.value="")},v=async()=>{if(i.value)if(n.value||d.value){u.value=!0;try{const e=new FormData;e.append("receiveTime",i.value),n.value&&e.append("isaFile",n.value),d.value&&e.append("bolFile",d.value),l("submit",e),k()}catch(e){console.error("上传失败:",e),c.nk.error("上传失败，请重试")}finally{u.value=!1}}else c.nk.warning("请至少上传一个POD文件");else c.nk.warning("请选择签收时间")};return{dialogVisible:a,receiveTime:i,isaFileInput:s,bolFileInput:t,uploading:u,handleIsaUpload:p,handleBolUpload:r,handleIsaFileChange:h,handleBolFileChange:b,handleClose:k,handleSubmit:v}}};var b=a(6262);const k=(0,b.A)(h,[["render",r],["__scopeId","data-v-37de2916"]]),v=k},3473:(e,l,a)=>{a.d(l,{A:()=>m});var o=a(641);const i={class:"dialog-footer"};function s(e,l,a,s,t,n){const d=(0,o.g2)("el-option"),u=(0,o.g2)("el-select"),p=(0,o.g2)("el-form-item"),r=(0,o.g2)("el-input"),m=(0,o.g2)("upload-filled"),c=(0,o.g2)("el-icon"),h=(0,o.g2)("el-upload"),b=(0,o.g2)("el-form"),k=(0,o.g2)("el-button"),v=(0,o.g2)("el-dialog");return(0,o.uX)(),(0,o.Wv)(v,{title:"文件上传",modelValue:s.dialogVisible,"onUpdate:modelValue":l[2]||(l[2]=e=>s.dialogVisible=e),width:"600px",onClose:s.handleClose},{footer:(0,o.k6)((()=>[(0,o.Lk)("span",i,[(0,o.bF)(k,{onClick:s.handleClose},{default:(0,o.k6)((()=>l[5]||(l[5]=[(0,o.eW)("取消")]))),_:1},8,["onClick"]),(0,o.bF)(k,{type:"primary",onClick:s.handleSubmit,disabled:!s.isValid},{default:(0,o.k6)((()=>l[6]||(l[6]=[(0,o.eW)("确定")]))),_:1},8,["onClick","disabled"])])])),default:(0,o.k6)((()=>[(0,o.bF)(b,{model:s.form,"label-width":"100px"},{default:(0,o.k6)((()=>[(0,o.bF)(p,{label:"文件标签",required:""},{default:(0,o.k6)((()=>[(0,o.bF)(u,{modelValue:s.form.fileTag,"onUpdate:modelValue":l[0]||(l[0]=e=>s.form.fileTag=e),placeholder:"请选择文件标签",style:{width:"100%"}},{default:(0,o.k6)((()=>[(0,o.bF)(d,{label:"异常文件",value:"abnormal"}),(0,o.bF)(d,{label:"留底文件",value:"record"})])),_:1},8,["modelValue"])])),_:1}),(0,o.bF)(p,{label:"备注"},{default:(0,o.k6)((()=>[(0,o.bF)(r,{modelValue:s.form.remark,"onUpdate:modelValue":l[1]||(l[1]=e=>s.form.remark=e),type:"textarea",rows:3,placeholder:"请输入备注信息"},null,8,["modelValue"])])),_:1}),(0,o.bF)(p,{label:"上传文件",required:""},{default:(0,o.k6)((()=>[(0,o.bF)(h,{class:"upload-area",drag:"",action:"#","auto-upload":!1,"on-change":s.handleFileChange,"on-remove":s.handleFileRemove,"file-list":s.fileList,limit:5,multiple:"",accept:".pdf,.jpg,.jpeg,.png"},{tip:(0,o.k6)((()=>l[3]||(l[3]=[(0,o.Lk)("div",{class:"el-upload__tip"}," 支持 .pdf、.jpg、.jpeg、.png 格式，单个文件不超过 10MB ",-1)]))),default:(0,o.k6)((()=>[(0,o.bF)(c,{class:"el-icon--upload"},{default:(0,o.k6)((()=>[(0,o.bF)(m)])),_:1}),l[4]||(l[4]=(0,o.Lk)("div",{class:"el-upload__text"},[(0,o.eW)(" 将文件拖到此处，或"),(0,o.Lk)("em",null,"点击上传")],-1))])),_:1},8,["on-change","on-remove","file-list"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue","onClose"])}var t=a(953),n=a(8548),d=a(163);const u={name:"FileUploadWithTagDialog",components:{UploadFilled:n.m8m},props:{visible:{type:Boolean,default:!1}},emits:["update:visible","submit","cancel"],setup(e,{emit:l}){const a=(0,o.EW)({get:()=>e.visible,set:e=>l("update:visible",e)}),i=(0,t.KR)({fileTag:"",remark:"",files:[]}),s=(0,t.KR)([]),n=(0,o.EW)((()=>i.value.fileTag&&s.value.length>0)),u=e=>{const l=["application/pdf","image/jpeg","image/png"];if(!l.includes(e.raw.type))return d.nk.error("不支持的文件类型"),!1;const a=10485760;if(e.raw.size>a)return d.nk.error("文件大小不能超过 10MB"),!1;i.value.files.push(e.raw)},p=e=>{const l=i.value.files.findIndex((l=>l===e.raw));l>-1&&i.value.files.splice(l,1)},r=()=>{n.value?l("submit",{fileTag:i.value.fileTag,remark:i.value.remark,files:i.value.files}):d.nk.warning("请选择文件标签并上传文件")},m=()=>{i.value={fileTag:"",remark:"",files:[]},s.value=[],l("cancel")};return{dialogVisible:a,form:i,fileList:s,isValid:n,handleFileChange:u,handleFileRemove:p,handleSubmit:r,handleClose:m}}};var p=a(6262);const r=(0,p.A)(u,[["render",s],["__scopeId","data-v-65f8b366"]]),m=r},5493:(e,l,a)=>{a.d(l,{A:()=>I});var o=a(641),i=a(33);const s={class:"basic-info"},t={class:"memo-content"},n={class:"expense-table"},d={key:1,class:"pushed-expense"},u={class:"operation-buttons"},p={class:"memo-history"},r={class:"memo-header"},m={class:"memo-time"},c={class:"memo-user"},h={class:"memo-text"},b={class:"follow-up-history"},k={class:"follow-up-header"},v={class:"follow-up-time"},g={class:"follow-up-user"},w={class:"follow-up-content"},f={class:"follow-up-text"},y={key:0,class:"follow-up-images"},C={class:"add-follow-up"},_={class:"upload-images"},F={class:"pod-images"},V={class:"dialog-footer"};function x(e,l,a,x,T,L){const D=(0,o.g2)("el-descriptions-item"),P=(0,o.g2)("el-button"),U=(0,o.g2)("el-descriptions"),I=(0,o.g2)("el-option"),W=(0,o.g2)("el-select"),N=(0,o.g2)("el-table-column"),E=(0,o.g2)("el-input"),X=(0,o.g2)("el-table"),R=(0,o.g2)("el-dialog"),A=(0,o.g2)("el-image"),B=(0,o.g2)("plus"),M=(0,o.g2)("el-icon"),K=(0,o.g2)("el-upload");return(0,o.uX)(),(0,o.Wv)(R,{title:"费用明细",modelValue:T.dialogVisible,"onUpdate:modelValue":l[4]||(l[4]=e=>T.dialogVisible=e),width:"1200px","close-on-click-modal":!1,"destroy-on-close":!0,class:"expense-detail-dialog"},{footer:(0,o.k6)((()=>[(0,o.Lk)("span",V,[(0,o.bF)(P,{onClick:L.handleClose},{default:(0,o.k6)((()=>l[10]||(l[10]=[(0,o.eW)("关闭")]))),_:1},8,["onClick"])])])),default:(0,o.k6)((()=>[(0,o.Lk)("div",s,[(0,o.bF)(U,{column:3,border:""},{default:(0,o.k6)((()=>[(0,o.bF)(D,{label:"车次号"},{default:(0,o.k6)((()=>[(0,o.eW)((0,i.v_)(T.basicInfo.trainNumber),1)])),_:1}),(0,o.bF)(D,{label:"装车类型"},{default:(0,o.k6)((()=>[(0,o.eW)((0,i.v_)(T.basicInfo.loadingType),1)])),_:1}),(0,o.bF)(D,{label:"派送类型"},{default:(0,o.k6)((()=>[(0,o.eW)((0,i.v_)(T.basicInfo.deliveryType),1)])),_:1}),(0,o.bF)(D,{label:"装车预约时间"},{default:(0,o.k6)((()=>[(0,o.eW)((0,i.v_)(T.basicInfo.loadingAppointmentTime),1)])),_:1}),(0,o.bF)(D,{label:"Memo"},{default:(0,o.k6)((()=>[(0,o.Lk)("div",t,[(0,o.Lk)("span",null,(0,i.v_)(T.basicInfo.memo),1),(0,o.bF)(P,{type:"primary",link:"",onClick:L.showMemoDialog},{default:(0,o.k6)((()=>l[5]||(l[5]=[(0,o.eW)("查看历史")]))),_:1},8,["onClick"])])])),_:1}),(0,o.bF)(D,{label:"备注"},{default:(0,o.k6)((()=>[(0,o.eW)((0,i.v_)(T.basicInfo.remarks),1)])),_:1})])),_:1})]),(0,o.Lk)("div",n,[(0,o.bF)(X,{data:T.tableData,border:"",style:{width:"100%"},"header-cell-style":{background:"#f5f7fa"},"row-class-name":L.getRowClassName},{default:(0,o.k6)((()=>[(0,o.bF)(N,{prop:"pcNumber",label:"PC号",width:"150"},{default:(0,o.k6)((e=>[e.row.isPushed?((0,o.uX)(),(0,o.CE)("span",{key:1,class:(0,i.C4)({"pushed-text":e.row.isPushed})},(0,i.v_)(e.row.pcNumber),3)):((0,o.uX)(),(0,o.Wv)(W,{key:0,modelValue:e.row.pcNumber,"onUpdate:modelValue":l=>e.row.pcNumber=l,placeholder:"请选择PC号",style:{width:"100%"},onChange:l=>L.handlePCChange(e.row)},{default:(0,o.k6)((()=>[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(L.availablePCs,(e=>((0,o.uX)(),(0,o.Wv)(I,{key:e.pcNumber,label:e.pcNumber,value:e.pcNumber},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]))])),_:1}),(0,o.bF)(N,{prop:"appointmentTime",label:"预约时间",width:"160"},{default:(0,o.k6)((e=>[(0,o.Lk)("span",{class:(0,i.C4)({"pushed-text":e.row.isPushed})},(0,i.v_)(e.row.appointmentTime),3)])),_:1}),(0,o.bF)(N,{prop:"appointmentNumber",label:"预约号",width:"120"},{default:(0,o.k6)((e=>[(0,o.Lk)("span",{class:(0,i.C4)({"pushed-text":e.row.isPushed})},(0,i.v_)(e.row.appointmentNumber),3)])),_:1}),(0,o.bF)(N,{prop:"destination",label:"目的地",width:"180"},{default:(0,o.k6)((e=>[(0,o.Lk)("span",{class:(0,i.C4)({"pushed-text":e.row.isPushed})},(0,i.v_)(e.row.destination),3)])),_:1}),(0,o.bF)(N,{prop:"palletCount",label:"板数",width:"80"},{default:(0,o.k6)((e=>[(0,o.Lk)("span",{class:(0,i.C4)({"pushed-text":e.row.isPushed})},(0,i.v_)(e.row.palletCount),3)])),_:1}),(0,o.bF)(N,{prop:"weight",label:"重量",width:"100"},{default:(0,o.k6)((e=>[(0,o.Lk)("span",{class:(0,i.C4)({"pushed-text":e.row.isPushed})},(0,i.v_)(e.row.weight),3)])),_:1}),(0,o.bF)(N,{prop:"volume",label:"方数",width:"100"},{default:(0,o.k6)((e=>[(0,o.Lk)("span",{class:(0,i.C4)({"pushed-text":e.row.isPushed})},(0,i.v_)(e.row.volume),3)])),_:1}),(0,o.bF)(N,{prop:"driverDepartureTime",label:"司机出发时间",width:"160"},{default:(0,o.k6)((e=>[(0,o.Lk)("span",{class:(0,i.C4)({"pushed-text":e.row.isPushed})},(0,i.v_)(e.row.driverDepartureTime),3)])),_:1}),(0,o.bF)(N,{prop:"driverArrivalTime",label:"司机到达时间",width:"160"},{default:(0,o.k6)((e=>[(0,o.Lk)("span",{class:(0,i.C4)({"pushed-text":e.row.isPushed})},(0,i.v_)(e.row.driverArrivalTime),3)])),_:1}),(0,o.bF)(N,{prop:"warehouseCompleteTime",label:"交仓完成时间",width:"160"},{default:(0,o.k6)((e=>[(0,o.Lk)("span",{class:(0,i.C4)({"pushed-text":e.row.isPushed})},(0,i.v_)(e.row.warehouseCompleteTime),3)])),_:1}),(0,o.bF)(N,{label:"费用类型",width:"120"},{default:(0,o.k6)((e=>[e.row.isPushed?((0,o.uX)(),(0,o.CE)("span",{key:1,class:(0,i.C4)({"pushed-text":e.row.isPushed})},(0,i.v_)(L.getExpenseTypeLabel(e.row.expenseType)),3)):((0,o.uX)(),(0,o.Wv)(W,{key:0,modelValue:e.row.expenseType,"onUpdate:modelValue":l=>e.row.expenseType=l,placeholder:"请选择",style:{width:"100%"}},{default:(0,o.k6)((()=>[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(T.expenseTypes,(e=>((0,o.uX)(),(0,o.Wv)(I,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"]))])),_:1}),(0,o.bF)(N,{label:"费用备注",width:"200"},{default:(0,o.k6)((e=>[e.row.isPushed?((0,o.uX)(),(0,o.CE)("span",{key:1,class:(0,i.C4)({"pushed-text":e.row.isPushed})},(0,i.v_)(e.row.expenseRemark||"-"),3)):((0,o.uX)(),(0,o.Wv)(E,{key:0,modelValue:e.row.expenseRemark,"onUpdate:modelValue":l=>e.row.expenseRemark=l,type:"textarea",rows:1,placeholder:"请输入费用备注",size:"small"},null,8,["modelValue","onUpdate:modelValue"]))])),_:1}),(0,o.bF)(N,{label:"费用",width:"150"},{default:(0,o.k6)((e=>[e.row.isPushed?((0,o.uX)(),(0,o.CE)("span",d,(0,i.v_)(e.row.expense),1)):((0,o.uX)(),(0,o.Wv)(E,{key:0,modelValue:e.row.expense,"onUpdate:modelValue":l=>e.row.expense=l,modelModifiers:{number:!0},size:"small",type:"number",controls:!1,onInput:l=>L.handleExpenseInput(e.row),onBlur:l=>L.handleExpenseChange(e.row)},null,8,["modelValue","onUpdate:modelValue","onInput","onBlur"]))])),_:1}),(0,o.bF)(N,{label:"操作",width:"200",fixed:"right"},{default:(0,o.k6)((e=>[(0,o.Lk)("div",u,[e.row.isPushed?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.Wv)(P,{key:0,type:"primary",size:"small",onClick:l=>L.handlePushExpense(e.row),disabled:!e.row.pcNumber},{default:(0,o.k6)((()=>l[6]||(l[6]=[(0,o.eW)(" 推送费用 ")]))),_:2},1032,["onClick","disabled"])),e.row.isPushed?((0,o.uX)(),(0,o.Wv)(P,{key:1,type:"info",size:"small",onClick:l=>L.handleCancelPush(e.row)},{default:(0,o.k6)((()=>l[7]||(l[7]=[(0,o.eW)(" 取消推送 ")]))),_:2},1032,["onClick"])):(0,o.Q3)("",!0),(0,o.bF)(P,{type:"primary",link:"",size:"small",onClick:l=>L.showFollowUpDialog(e.row)},{default:(0,o.k6)((()=>l[8]||(l[8]=[(0,o.eW)(" 跟进记录 ")]))),_:2},1032,["onClick"])])])),_:1})])),_:1},8,["data","row-class-name"])]),(0,o.bF)(R,{modelValue:T.memoDialogVisible,"onUpdate:modelValue":l[0]||(l[0]=e=>T.memoDialogVisible=e),title:"MEMO历史记录",width:"600px","append-to-body":""},{default:(0,o.k6)((()=>[(0,o.Lk)("div",p,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(T.memoHistory,((e,l)=>((0,o.uX)(),(0,o.CE)("div",{key:l,class:"memo-item"},[(0,o.Lk)("div",r,[(0,o.Lk)("span",m,(0,i.v_)(e.createTime),1),(0,o.Lk)("span",c,(0,i.v_)(e.createUser),1)]),(0,o.Lk)("div",h,(0,i.v_)(e.content),1)])))),128))])])),_:1},8,["modelValue"]),(0,o.bF)(R,{modelValue:T.followUpDialogVisible,"onUpdate:modelValue":l[2]||(l[2]=e=>T.followUpDialogVisible=e),title:"跟进记录",width:"800px","append-to-body":""},{default:(0,o.k6)((()=>[(0,o.Lk)("div",b,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(T.followUpHistory,((e,l)=>((0,o.uX)(),(0,o.CE)("div",{key:l,class:"follow-up-item"},[(0,o.Lk)("div",k,[(0,o.Lk)("span",v,(0,i.v_)(e.createTime),1),(0,o.Lk)("span",g,(0,i.v_)(e.createUser),1)]),(0,o.Lk)("div",w,[(0,o.Lk)("div",f,(0,i.v_)(e.content),1),e.images?.length?((0,o.uX)(),(0,o.CE)("div",y,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.images,((l,a)=>((0,o.uX)(),(0,o.Wv)(A,{key:a,src:l,"preview-src-list":e.images,fit:"cover",class:"follow-up-image"},null,8,["src","preview-src-list"])))),128))])):(0,o.Q3)("",!0)])])))),128))]),(0,o.Lk)("div",C,[(0,o.bF)(E,{modelValue:T.newFollowUp.content,"onUpdate:modelValue":l[1]||(l[1]=e=>T.newFollowUp.content=e),type:"textarea",rows:"3",placeholder:"请输入跟进内容"},null,8,["modelValue"]),(0,o.Lk)("div",_,[(0,o.bF)(K,{action:"#","list-type":"picture-card","auto-upload":!1,"on-change":L.handleImageChange},{default:(0,o.k6)((()=>[(0,o.bF)(M,null,{default:(0,o.k6)((()=>[(0,o.bF)(B)])),_:1})])),_:1},8,["on-change"])]),(0,o.bF)(P,{type:"primary",onClick:L.submitFollowUp},{default:(0,o.k6)((()=>l[9]||(l[9]=[(0,o.eW)("提交跟进")]))),_:1},8,["onClick"])])])),_:1},8,["modelValue"]),(0,o.bF)(R,{modelValue:T.podDialogVisible,"onUpdate:modelValue":l[3]||(l[3]=e=>T.podDialogVisible=e),title:"POD图片",width:"800px","append-to-body":""},{default:(0,o.k6)((()=>[(0,o.Lk)("div",F,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(T.currentPodImages,((e,l)=>((0,o.uX)(),(0,o.Wv)(A,{key:l,src:e,"preview-src-list":T.currentPodImages,fit:"cover",class:"pod-image"},null,8,["src","preview-src-list"])))),128))])])),_:1},8,["modelValue"])])),_:1},8,["modelValue"])}var T=a(8548),L=a(163);const D={name:"ExpenseDetailDialog",components:{Plus:T.FWt},props:{visible:{type:Boolean,default:!1},trainData:{type:Object,default:()=>({})},expenseType:{type:String,default:"all"}},emits:["update:visible","expense-pushed","push-cancelled"],data(){return{dialogVisible:!1,memoDialogVisible:!1,followUpDialogVisible:!1,podDialogVisible:!1,basicInfo:{trainNumber:"",loadingType:"",deliveryType:"",loadingAppointmentTime:"",memo:"",remarks:""},tableData:[{pcNumber:"",appointmentTime:"",appointmentNumber:"",destination:"",palletCount:"",weight:"",volume:"",driverDepartureTime:"",driverArrivalTime:"",warehouseCompleteTime:"",podImages:[],expense:0,expenseType:"",expenseRemark:"",isPushed:!1}],memoHistory:[],followUpHistory:[],currentPodImages:[],newFollowUp:{content:"",images:[]},selectedPcData:null,expenseTypes:[{value:"delivery",label:"派送费"},{value:"exception",label:"异常费"},{value:"storage",label:"仓储费"},{value:"other",label:"其他费用"}]}},computed:{availablePCs(){return this.trainData.children||[]}},watch:{visible:{immediate:!0,handler(e){this.dialogVisible=e,e&&this.initData()}},dialogVisible(e){e||this.$emit("update:visible",!1)}},methods:{async initData(){this.basicInfo={trainNumber:this.trainData.trainNumber||"",loadingType:this.trainData.loadingType||"",deliveryType:this.trainData.deliveryType||"",loadingAppointmentTime:this.trainData.loadingAppointmentTime||"",memo:this.trainData.Memo||"",remarks:this.trainData.warehouseRemarks||""},this.tableData=[{pcNumber:"",appointmentTime:"",appointmentNumber:"",destination:"",palletCount:"",weight:"",volume:"",driverDepartureTime:"",driverArrivalTime:"",warehouseCompleteTime:"",podImages:[],expense:0,expenseType:"",expenseRemark:"",isPushed:!1}]},handlePCChange(e){const l=this.availablePCs.find((l=>l.pcNumber===e.pcNumber));l&&(e.appointmentTime=l.bookingTime,e.appointmentNumber=l.bookingNumber,e.destination=l.destination,e.palletCount=l.palletCount,e.weight=l.weight,e.volume=l.volume,e.driverDepartureTime=l.DriverStartTime,e.driverArrivalTime=l.DriverEndTime,e.warehouseCompleteTime=l.Arrived,e.podImages=l.podImages||[])},async showMemoDialog(){this.memoHistory=[{createTime:(new Date).toLocaleString(),createUser:"系统",content:this.trainData.Memo||"暂无MEMO记录"}],this.memoDialogVisible=!0},async showFollowUpDialog(e){this.selectedPcData=e,this.followUpHistory=[{createTime:(new Date).toLocaleString(),createUser:"系统",content:this.trainData.Followup||"暂无跟进记录"}],this.followUpDialogVisible=!0},handleViewPOD(e){this.currentPodImages=e.podImages||[],this.podDialogVisible=!0},handleImageChange(e){const l=e.raw.type.startsWith("image/");l?this.newFollowUp.images.push(e.url):L.nk.error("只能上传图片文件!")},async submitFollowUp(){if(this.newFollowUp.content.trim())try{await fetch(`/api/pc/${this.selectedPcData.pcNumber}/follow-up`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.newFollowUp)});const e=await fetch(`/api/pc/${this.selectedPcData.pcNumber}/follow-up-history`),l=await e.json();this.followUpHistory=l,this.newFollowUp={content:"",images:[]},L.nk.success("提交成功")}catch(e){console.error("提交跟进记录失败:",e),L.nk.error("提交失败，请重试")}else L.nk.warning("请输入跟进内容")},handleExpenseChange(e){console.log("费用变更:",e)},getRowClassName({row:e}){return e.isPushed?"pushed-row":""},handleExpenseInput(e){e.expense&&(e.expense=Number(e.expense))},handlePushExpense(e){e.pcNumber?e.expenseType?e.expense?(e.isPushed=!0,this.$emit("expense-pushed",e),L.nk.success("费用推送成功")):L.nk.warning("请输入费用金额"):L.nk.warning("请选择费用类型"):L.nk.warning("请选择PC号")},handleCancelPush(e){e.isPushed=!1,this.$emit("push-cancelled",e),L.nk.success("已取消推送")},handleClose(){this.dialogVisible=!1},getExpenseTypeLabel(e){const l=this.expenseTypes.find((l=>l.value===e));return l?l.label:e}}};var P=a(6262);const U=(0,P.A)(D,[["render",x],["__scopeId","data-v-8f8a3b6a"]]),I=U}}]);
//# sourceMappingURL=628.977aa318.js.map