"use strict";(self["webpackChunkvue_logistics_system"]=self["webpackChunkvue_logistics_system"]||[]).push([[880],{880:(e,l,a)=>{a.r(l),a.d(l,{default:()=>p});var t=a(641),o=a(33),i=a(953),d=a(7918),u=a(163),n=a(1303);const r={class:"metric-rule-config-container"},s={class:"card-header"},c={__name:"MetricRuleConfig",setup(e){const l=(0,i.KR)(null),a=(0,i.KR)(!1),c=(0,i.KR)(null),m=(0,i.KR)(!1),b=(0,i.KR)(!1),p=(0,i.KR)([]),_=(0,i.KR)([]),g=()=>({id:null,name:"",description:"",dimensionId:null,calculationPeriod:"monthly",baseDataTable:null,associatedFieldRuleIds:[],calculationMethod:"SUCCESS_RATE",maxScore:100}),v=(0,i.Kh)(g()),h=(0,i.Kh)({name:[{required:!0,message:"请输入指标规则名称",trigger:"blur"}],dimensionId:[{required:!0,message:"请选择所属维度",trigger:"change"}],calculationPeriod:[{required:!0,message:"请选择计算周期",trigger:"change"}],baseDataTable:[{required:!0,message:"请选择基础数据表",trigger:"change"}],calculationMethod:[{required:!0,message:"请选择得分计算方法",trigger:"change"}],maxScore:[{required:!0,message:"请输入满分值",trigger:"blur"},{type:"number",min:0,message:"满分值不能小于0"}]}),k=(0,i.KR)([]),f={monthly:"月度",quarterly:"季度",yearly:"年度"},F={SUCCESS_RATE:"成功率 (1 - 失败率)",DEDUCTION_SUBTRACT:"扣分累加制 (满分 - 总扣分)",DEDUCTION_SUM:"仅统计总扣分值",CUSTOM_FORMULA_A:"自定义分数映射 (待明确)"};(0,t.sV)((async()=>{await w(),await y()}));const w=async()=>{await new Promise((e=>setTimeout(e,100))),p.value=[{id:"dim_1",name:"时效性",weight:40},{id:"dim_2",name:"服务质量",weight:30},{id:"dim_3",name:"成本控制",weight:20},{id:"dim_4",name:"合规与配合度",weight:10}],await new Promise((e=>setTimeout(e,100))),_.value=[{value:"order",label:"订单表 (order)"},{value:"cargo_damage",label:"货损记录表 (cargo_damage)"},{value:"complaint",label:"投诉记录表 (complaint)"}]},y=async()=>{b.value=!0,await new Promise((e=>setTimeout(e,500))),k.value=[{id:`metric_${(0,n.A)()}`,name:"准时提货率评分",description:"基于订单实际提货时间和计划时间的比较，计算准时率得分",dimensionId:"dim_1",calculationPeriod:"monthly",baseDataTable:"order",associatedFieldRuleIds:["rule_1"],calculationMethod:"SUCCESS_RATE",maxScore:100},{id:`metric_${(0,n.A)()}`,name:"货损扣分统计",description:"累加与货损相关的字段规则扣分",dimensionId:"dim_2",calculationPeriod:"quarterly",baseDataTable:"cargo_damage",associatedFieldRuleIds:["rule_calc_or"],calculationMethod:"DEDUCTION_SUBTRACT",maxScore:100}],b.value=!1},T=e=>{const l=p.value.find((l=>l.id===e));return l?l.name:"未知维度"},C=()=>{const e=g();Object.assign(v,e),a.value=!1,c.value=null,(0,t.dY)((()=>{l.value?.clearValidate()}))},S=()=>{C()},U=e=>{a.value=!0,c.value=e.id,Object.assign(v,JSON.parse(JSON.stringify(e))),(0,t.dY)((()=>{l.value?.clearValidate()}))},V=e=>{const l=k.value.find((l=>l.id===e));d.s.confirm(`确定要删除指标规则 "${l?.name||e}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{console.log("删除指标规则 ID:",e),b.value=!0,await new Promise((e=>setTimeout(e,300))),b.value=!1,u.nk.success("指标规则删除成功"),y(),a.value&&c.value===e&&C()})).catch((()=>{}))},R=()=>{l.value?.validate((async e=>{if(!e)return u.nk.error("表单验证失败，请检查输入项。"),!1;m.value=!0;try{const e=JSON.parse(JSON.stringify(v));a.value?(console.log("更新指标规则:",e),await new Promise((e=>setTimeout(e,500))),u.nk.success("指标规则更新成功")):(e.id=`metric_${(0,n.A)()}`,console.log("创建指标规则:",e),await new Promise((e=>setTimeout(e,500))),u.nk.success("指标规则创建成功")),C(),y()}catch(l){console.error("保存指标规则失败:",l),u.nk.error("保存指标规则失败，请稍后重试。")}finally{m.value=!1}}))};return(e,i)=>{const d=(0,t.g2)("el-button"),u=(0,t.g2)("el-input"),n=(0,t.g2)("el-form-item"),c=(0,t.g2)("el-option"),g=(0,t.g2)("el-select"),w=(0,t.g2)("el-alert"),y=(0,t.g2)("el-input-number"),I=(0,t.g2)("el-form"),D=(0,t.g2)("el-card"),M=(0,t.g2)("el-col"),E=(0,t.g2)("el-table-column"),P=(0,t.g2)("el-table"),x=(0,t.g2)("el-row"),A=(0,t.gN)("loading");return(0,t.uX)(),(0,t.CE)("div",r,[(0,t.bF)(x,{gutter:20},{default:(0,t.k6)((()=>[(0,t.bF)(M,{span:10},{default:(0,t.k6)((()=>[(0,t.bF)(D,null,{header:(0,t.k6)((()=>[(0,t.Lk)("div",s,[(0,t.Lk)("span",null,(0,o.v_)(a.value?"编辑指标规则":"创建新指标规则"),1),a.value?((0,t.uX)(),(0,t.Wv)(d,{key:0,type:"text",onClick:S},{default:(0,t.k6)((()=>i[8]||(i[8]=[(0,t.eW)("取消编辑")]))),_:1})):(0,t.Q3)("",!0)])])),default:(0,t.k6)((()=>[(0,t.bF)(I,{model:v,ref_key:"metricFormRef",ref:l,rules:h,"label-position":"top"},{default:(0,t.k6)((()=>[(0,t.bF)(n,{label:"指标规则名称",prop:"name"},{default:(0,t.k6)((()=>[(0,t.bF)(u,{modelValue:v.name,"onUpdate:modelValue":i[0]||(i[0]=e=>v.name=e),placeholder:"例如：准时提货率评分"},null,8,["modelValue"])])),_:1}),(0,t.bF)(n,{label:"所属维度",prop:"dimensionId"},{default:(0,t.k6)((()=>[(0,t.bF)(g,{modelValue:v.dimensionId,"onUpdate:modelValue":i[1]||(i[1]=e=>v.dimensionId=e),placeholder:"选择归属的评分维度",style:{width:"100%"}},{default:(0,t.k6)((()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(p.value,(e=>((0,t.uX)(),(0,t.Wv)(c,{key:e.id,label:`${e.name} (${e.weight}%)`,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,t.bF)(n,{label:"计算周期",prop:"calculationPeriod"},{default:(0,t.k6)((()=>[(0,t.bF)(g,{modelValue:v.calculationPeriod,"onUpdate:modelValue":i[2]||(i[2]=e=>v.calculationPeriod=e),placeholder:"选择计算周期",style:{width:"100%"}},{default:(0,t.k6)((()=>[(0,t.bF)(c,{label:"月度",value:"monthly"}),(0,t.bF)(c,{label:"季度",value:"quarterly"})])),_:1},8,["modelValue"])])),_:1}),(0,t.bF)(n,{label:"基础数据表",prop:"baseDataTable"},{default:(0,t.k6)((()=>[(0,t.bF)(g,{modelValue:v.baseDataTable,"onUpdate:modelValue":i[3]||(i[3]=e=>v.baseDataTable=e),placeholder:"选择计算依据的主要数据表",style:{width:"100%"}},{default:(0,t.k6)((()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(_.value,(e=>((0,t.uX)(),(0,t.Wv)(c,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,t.bF)(n,{label:"关联字段规则",prop:"associatedFieldRuleIds"},{default:(0,t.k6)((()=>[(0,t.bF)(w,{type:"info",closable:!1},{default:(0,t.k6)((()=>i[9]||(i[9]=[(0,t.eW)(" 请选择计算此指标时需要评估的所有字段规则。 (UI 待实现，当前请手动记录或在描述中注明) ")]))),_:1}),(0,t.bF)(g,{modelValue:v.associatedFieldRuleIds,"onUpdate:modelValue":i[4]||(i[4]=e=>v.associatedFieldRuleIds=e),multiple:"",filterable:"",placeholder:"选择关联的字段规则 (多选)",style:{width:"100%","margin-top":"10px"},disabled:""},null,8,["modelValue"])])),_:1}),(0,t.bF)(n,{label:"得分计算方法",prop:"calculationMethod"},{default:(0,t.k6)((()=>[(0,t.bF)(g,{modelValue:v.calculationMethod,"onUpdate:modelValue":i[5]||(i[5]=e=>v.calculationMethod=e),placeholder:"选择得分计算方式",style:{width:"100%"}},{default:(0,t.k6)((()=>[(0,t.bF)(c,{label:"成功率 (1 - 失败率)",value:"SUCCESS_RATE"}),(0,t.bF)(c,{label:"扣分累加制 (满分 - 总扣分)",value:"DEDUCTION_SUBTRACT"}),(0,t.bF)(c,{label:"仅统计总扣分值",value:"DEDUCTION_SUM"}),(0,t.bF)(c,{label:"自定义分数映射 (待明确)",value:"CUSTOM_FORMULA_A",disabled:""})])),_:1},8,["modelValue"])])),_:1}),(0,t.bF)(n,{label:"满分值",prop:"maxScore"},{default:(0,t.k6)((()=>[(0,t.bF)(y,{modelValue:v.maxScore,"onUpdate:modelValue":i[6]||(i[6]=e=>v.maxScore=e),min:0,step:10,"controls-position":"right",style:{width:"100%"}},null,8,["modelValue"])])),_:1}),(0,t.bF)(n,{label:"描述 (可选)"},{default:(0,t.k6)((()=>[(0,t.bF)(u,{type:"textarea",modelValue:v.description,"onUpdate:modelValue":i[7]||(i[7]=e=>v.description=e),placeholder:"简要说明指标规则的计算逻辑和用途"},null,8,["modelValue"])])),_:1}),(0,t.bF)(n,null,{default:(0,t.k6)((()=>[(0,t.bF)(d,{type:"primary",onClick:R,loading:m.value},{default:(0,t.k6)((()=>[(0,t.eW)((0,o.v_)(a.value?"更新指标规则":"创建指标规则"),1)])),_:1},8,["loading"]),(0,t.bF)(d,{onClick:C},{default:(0,t.k6)((()=>i[10]||(i[10]=[(0,t.eW)("重置")]))),_:1})])),_:1})])),_:1},8,["model","rules"])])),_:1})])),_:1}),(0,t.bF)(M,{span:14},{default:(0,t.k6)((()=>[(0,t.bF)(D,null,{header:(0,t.k6)((()=>i[11]||(i[11]=[(0,t.Lk)("div",{class:"card-header"},[(0,t.Lk)("span",null,"已配置的指标/维度规则")],-1)]))),default:(0,t.k6)((()=>[(0,t.bo)(((0,t.uX)(),(0,t.Wv)(P,{data:k.value,style:{width:"100%"},border:"",height:"500px"},{default:(0,t.k6)((()=>[(0,t.bF)(E,{prop:"name",label:"规则名称",width:"180","show-overflow-tooltip":""}),(0,t.bF)(E,{label:"所属维度",width:"150"},{default:(0,t.k6)((e=>[(0,t.eW)((0,o.v_)(T(e.row.dimensionId)),1)])),_:1}),(0,t.bF)(E,{prop:"calculationPeriod",label:"计算周期",width:"100"},{default:(0,t.k6)((e=>[(0,t.eW)((0,o.v_)(f[e.row.calculationPeriod]||e.row.calculationPeriod),1)])),_:1}),(0,t.bF)(E,{prop:"calculationMethod",label:"计算方法",width:"200"},{default:(0,t.k6)((e=>[(0,t.eW)((0,o.v_)(F[e.row.calculationMethod]||e.row.calculationMethod),1)])),_:1}),(0,t.bF)(E,{prop:"maxScore",label:"满分值",width:"80",align:"center"}),(0,t.bF)(E,{label:"操作",width:"150",align:"center",fixed:"right"},{default:(0,t.k6)((e=>[(0,t.bF)(d,{size:"small",type:"primary",onClick:l=>U(e.row)},{default:(0,t.k6)((()=>i[12]||(i[12]=[(0,t.eW)("编辑")]))),_:2},1032,["onClick"]),(0,t.bF)(d,{size:"small",type:"danger",onClick:l=>V(e.row.id)},{default:(0,t.k6)((()=>i[13]||(i[13]=[(0,t.eW)("删除")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[A,b.value]])])),_:1})])),_:1})])),_:1})])}}};var m=a(6262);const b=(0,m.A)(c,[["__scopeId","data-v-3ef6a466"]]),p=b}}]);
//# sourceMappingURL=880.87c10326.js.map