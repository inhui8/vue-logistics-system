{"version":3,"file":"js/9498.3f2f7576.js","mappings":"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","sources":["webpack://vue-logistics-system/./src/views/SMS/PhoneApp/StockingConfirm.vue","webpack://vue-logistics-system/./src/views/SMS/PhoneApp/StockingConfirm.vue?af64"],"sourcesContent":["<template>\r\n  <!-- 包裹层，用于居中显示手机模型 -->\r\n  <div class=\"stocking-view-wrapper\">\r\n    <div class=\"phone-mockup\">\r\n      <div class=\"phone-screen\">\r\n        <!-- 原 StockingConfirm.vue 的内容放在这里 -->\r\n        <div class=\"stocking-confirm-container-el\">\r\n          <el-page-header @back=\"goBack\" content=\"确认备货\">\r\n          </el-page-header>\r\n\r\n          <div class=\"train-info-el\">\r\n            <h2>车次号: {{ trainNumber }}</h2>\r\n            <!-- 可以添加更多从上一个页面传递过来的车次信息 -->\r\n          </div>\r\n\r\n          <div class=\"confirm-button-container-el\" v-if=\"!stockingStarted\">\r\n            <el-button type=\"primary\" @click=\"startStocking\" style=\"width: 100%;\">确认备货开始</el-button>\r\n          </div>\r\n\r\n          <!-- PC/卡板号维度的订单数据区域 -->\r\n          <div v-if=\"stockingStarted\" class=\"order-data-area-el\">\r\n            <p v-if=\"orderLoading\" class=\"loading-el\">加载订单中...</p>\r\n            <el-card \r\n              shadow=\"never\" \r\n              v-for=\"order in orderList\" \r\n              :key=\"order.palletCode\" \r\n              class=\"order-card-el\" \r\n              :class=\"{ 'stocked-el': order.status === 'stocked' }\"\r\n            >\r\n              <div class=\"order-details-el\">\r\n                <p><strong>卡板号:</strong> {{ order.palletCode }}</p>\r\n                <p><strong>PC号:</strong> {{ order.orderNumber }}</p>\r\n                <p><strong>原库位:</strong> {{ order.originalLocation }}</p>\r\n                <p><strong>指定库位:</strong> {{ order.targetLocation }}</p>\r\n                <p><strong>状态:</strong> <span :class=\"`status-${order.status}-el`\">{{ getStatusText(order.status) }}</span></p>\r\n              </div>\r\n              <div class=\"scan-actions-el\" v-if=\"order.status === 'pending'\">\r\n                <el-button size=\"small\" type=\"primary\" @click=\"simulateScanPallet(order)\" plain>扫卡板</el-button>\r\n                <el-button size=\"small\" type=\"warning\" @click=\"simulateScanOriginalLocation(order)\" :disabled=\"!order.palletScanned\" plain>扫原库位</el-button>\r\n                <el-button size=\"small\" type=\"success\" @click=\"simulateScanTargetLocation(order)\" :disabled=\"!order.originalLocationScanned\" plain>扫新库位</el-button>\r\n              </div>\r\n              <div v-if=\"order.status === 'stocked'\" class=\"stocked-indicator-el\">\r\n                 <el-icon color=\"#67C23A\" size=\"18\"><SuccessFilled /></el-icon> 已备货\r\n              </div>\r\n            </el-card>\r\n            <p v-if=\"!orderList.length && !orderLoading\" class=\"no-data-el\">没有需要备货的订单</p>\r\n          </div>\r\n\r\n           <!-- 模拟扫描输入 Dialog -->\r\n          <el-dialog\r\n             v-model=\"showScanDialog\"\r\n             :title=\"`扫描${scanType === 'pallet' ? '卡板' : scanType === 'originalLocation' ? '原库位' : '新库位'}: ${scanInputLabel}`\"\r\n             width=\"90%\" \r\n             :append-to-body=\"true\"\r\n             :close-on-click-modal=\"false\"\r\n             @closed=\"clearScanDialog\" \r\n           >\r\n             <el-input\r\n               v-model=\"scannedCode\"\r\n               :placeholder=\"`请输入模拟 ${scanType === 'pallet' ? '卡板' : scanType === 'originalLocation' ? '原库位' : '新库位'} 码`\"\r\n               clearable\r\n               @keyup.enter=\"confirmScan\"\r\n               ref=\"scanInputRef\" \r\n             />\r\n             <template #footer>\r\n               <span class=\"dialog-footer\">\r\n                 <el-button @click=\"showScanDialog = false\">取消</el-button>\r\n                 <el-button type=\"primary\" @click=\"confirmScan\">确认</el-button>\r\n               </span>\r\n             </template>\r\n           </el-dialog>\r\n\r\n           <!-- 总体备货完成按钮 (修改 v-if 条件) -->\r\n           <div class=\"footer-button-inside-phone\" v-if=\"stockingStarted\"> \r\n              <el-button type=\"success\" @click=\"completeStocking\" style=\"width: 100%;\">备货完成</el-button>\r\n           </div>\r\n\r\n        </div> \r\n        <!-- 原内容结束 -->\r\n        \r\n        <!-- 拍照上传对话框 -->\r\n        <el-dialog\r\n          v-model=\"showPhotoDialog\"\r\n          title=\"上传凭证照片\"\r\n          width=\"90%\"\r\n          :append-to-body=\"true\"\r\n          :close-on-click-modal=\"false\"\r\n          :show-close=\"false\"\r\n        >\r\n          <div class=\"photo-upload-container\">\r\n            <div v-if=\"!photoList.length\" class=\"photo-placeholder\">\r\n              <el-icon><Picture /></el-icon>\r\n              <p>请上传凭证照片</p>\r\n            </div>\r\n            <div v-else class=\"photo-preview\">\r\n              <div \r\n                v-for=\"(photo, index) in photoList\" \r\n                :key=\"index\" \r\n                class=\"photo-item\"\r\n              >\r\n                <img :src=\"photo.url\" alt=\"凭证照片\" />\r\n                <div class=\"photo-delete\" @click=\"removePhoto(index)\">\r\n                  <el-icon><Delete /></el-icon>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            \r\n            <div class=\"upload-actions\">\r\n              <el-upload\r\n                ref=\"uploadRef\"\r\n                :auto-upload=\"false\"\r\n                :show-file-list=\"false\"\r\n                :on-change=\"handlePhotoChange\"\r\n                :multiple=\"true\"\r\n                accept=\"image/*\"\r\n              >\r\n                <el-button type=\"primary\" plain>\r\n                  <el-icon><Upload /></el-icon>\r\n                  选择照片\r\n                </el-button>\r\n              </el-upload>\r\n              \r\n              <el-button type=\"success\" @click=\"takePhoto\" plain>\r\n                <el-icon><Camera /></el-icon>\r\n                拍照\r\n              </el-button>\r\n            </div>\r\n          </div>\r\n          \r\n          <template #footer>\r\n            <span class=\"dialog-footer\">\r\n              <el-button @click=\"cancelUpload\">取消</el-button>\r\n              <el-button type=\"primary\" @click=\"submitPhotos\" :disabled=\"!photoList.length\">提交</el-button>\r\n            </span>\r\n          </template>\r\n        </el-dialog>\r\n        \r\n        <!-- 拍照组件 -->\r\n        <el-dialog\r\n          v-model=\"showCameraDialog\"\r\n          title=\"拍摄凭证照片\"\r\n          width=\"90%\"\r\n          :append-to-body=\"true\"\r\n          :close-on-click-modal=\"false\"\r\n        >\r\n          <div class=\"camera-container\" v-if=\"hasCamera\">\r\n            <video ref=\"videoRef\" autoplay class=\"camera-video\"></video>\r\n            <div class=\"camera-actions\">\r\n              <el-button type=\"primary\" @click=\"capturePhoto\">拍照</el-button>\r\n              <el-button @click=\"showCameraDialog = false\">取消</el-button>\r\n            </div>\r\n          </div>\r\n          <div v-else class=\"camera-error\">\r\n            <el-icon><WarningFilled /></el-icon>\r\n            <p>无法访问摄像头，请检查权限或使用上传功能</p>\r\n          </div>\r\n        </el-dialog>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, reactive, onMounted, computed, nextTick, onUnmounted } from 'vue';\r\nimport { useRoute, useRouter } from 'vue-router';\r\nimport { ElPageHeader, ElButton, ElCard, ElDialog, ElInput, ElIcon, ElMessage, ElUpload } from 'element-plus';\r\nimport { SuccessFilled, Picture, Upload, Camera, Delete, WarningFilled } from '@element-plus/icons-vue';\r\n\r\nconst route = useRoute();\r\nconst router = useRouter();\r\n\r\nconst trainId = ref(null);\r\nconst trainNumber = ref(null);\r\nconst stockingStarted = ref(false);\r\n\r\nconst orderList = reactive([]);\r\nconst orderLoading = ref(false);\r\n\r\nconst showScanDialog = ref(false);\r\nconst scannedCode = ref('');\r\nconst scanType = ref(null);\r\nconst currentScanningOrder = ref(null);\r\nconst scanInputLabel = ref('');\r\nconst scanInputRef = ref(null);\r\n\r\n// 拍照上传相关\r\nconst showPhotoDialog = ref(false);\r\nconst showCameraDialog = ref(false);\r\nconst photoList = ref([]);\r\nconst hasCamera = ref(true);\r\nconst videoRef = ref(null);\r\nconst uploadRef = ref(null);\r\nlet mediaStream = null;\r\n\r\nonMounted(() => {\r\n  trainId.value = route.params.trainId;\r\n  trainNumber.value = route.params.trainNumber;\r\n\r\n  if (!trainId.value || !trainNumber.value) {\r\n    ElMessage.error('无效的车次信息');\r\n    // router.replace({ name: 'Stocking' });\r\n  }\r\n});\r\n\r\nconst goBack = () => {\r\n  router.back();\r\n};\r\n\r\nconst startStocking = () => {\r\n  console.log(`开始为车次 ${trainNumber.value} (ID: ${trainId.value}) 进行备货`);\r\n  stockingStarted.value = true;\r\n  orderList.length = 0;\r\n  fetchOrderData();\r\n};\r\n\r\nconst fetchOrderData = async () => {\r\n  orderLoading.value = true;\r\n  console.log('正在获取订单数据...');\r\n  try {\r\n    await new Promise(resolve => setTimeout(resolve, 500));\r\n\r\n    const mockData = [\r\n      { palletCode: 'PLT001', orderNumber: 'ORD1001', originalLocation: 'A1-01', targetLocation: 'B2-05', status: 'stocked' },\r\n      { palletCode: 'PLT002', orderNumber: 'ORD1002', originalLocation: 'A1-02', targetLocation: 'B2-06', status: 'pending' },\r\n      { palletCode: 'PLT003', orderNumber: 'ORD1003', originalLocation: 'C3-10', targetLocation: 'D4-11', status: 'pending' },\r\n      { palletCode: 'PLT004', orderNumber: 'ORD1004', originalLocation: 'C3-11', targetLocation: 'D4-12', status: 'pending' },\r\n      { palletCode: 'PLT005', orderNumber: 'ORD1005', originalLocation: 'E5-20', targetLocation: 'F6-21', status: 'pending' },\r\n    ];\r\n\r\n    const processedData = mockData.map(order => ({ \r\n      ...order, \r\n      palletScanned: false, \r\n      originalLocationScanned: false,\r\n      targetLocationScanned: false \r\n    }));\r\n    orderList.push(...processedData);\r\n  } catch (error) {\r\n    console.error('Failed to fetch order list:', error);\r\n    ElMessage.error('加载订单失败');\r\n  } finally {\r\n    orderLoading.value = false;\r\n  }\r\n};\r\n\r\nconst getStatusText = (status) => {\r\n  return status === 'pending' ? '待备货' : '已备货';\r\n};\r\n\r\nconst openScanDialog = () => {\r\n  showScanDialog.value = true;\r\n  nextTick(() => {\r\n    scanInputRef.value?.focus();\r\n  });\r\n}\r\n\r\nconst simulateScanPallet = (order) => {\r\n  scanType.value = 'pallet';\r\n  currentScanningOrder.value = order;\r\n  scanInputLabel.value = order.palletCode;\r\n  scannedCode.value = '';\r\n  openScanDialog();\r\n};\r\n\r\nconst simulateScanOriginalLocation = (order) => {\r\n  if (!order.palletScanned) {\r\n    ElMessage.warning('请先扫描卡板');\r\n    return;\r\n  }\r\n  scanType.value = 'originalLocation';\r\n  currentScanningOrder.value = order;\r\n  scanInputLabel.value = order.originalLocation;\r\n  scannedCode.value = '';\r\n  openScanDialog();\r\n};\r\n\r\nconst simulateScanTargetLocation = (order) => {\r\n  if (!order.originalLocationScanned) {\r\n    ElMessage.warning('请先扫描原库位');\r\n    return;\r\n  }\r\n  scanType.value = 'targetLocation';\r\n  currentScanningOrder.value = order;\r\n  scanInputLabel.value = order.targetLocation;\r\n  scannedCode.value = '';\r\n  openScanDialog();\r\n};\r\n\r\nconst confirmScan = () => {\r\n  if (!currentScanningOrder.value || !scanType.value) return;\r\n\r\n  const order = currentScanningOrder.value;\r\n  const code = scannedCode.value.trim();\r\n\r\n  if (!code) {\r\n    ElMessage.warning('请输入扫描码');\r\n    return;\r\n  }\r\n\r\n  console.log(`模拟扫描 ${scanType.value}: ${code}`);\r\n\r\n  let success = false;\r\n  if (scanType.value === 'pallet') {\r\n    if (code === order.palletCode) {\r\n      order.palletScanned = true;\r\n      ElMessage.success('卡板扫描成功');\r\n      success = true;\r\n    } else {\r\n      ElMessage.error('卡板码不匹配');\r\n    }\r\n  } else if (scanType.value === 'originalLocation') {\r\n    if (code === order.originalLocation) {\r\n      order.originalLocationScanned = true;\r\n      ElMessage.success('原库位扫描成功');\r\n      success = true;\r\n    } else {\r\n      ElMessage.error('原库位码不匹配');\r\n    }\r\n  } else if (scanType.value === 'targetLocation') {\r\n    if (code === order.targetLocation) {\r\n      order.targetLocationScanned = true;\r\n      order.status = 'stocked';\r\n      ElMessage.success('新库位扫描成功，备货完成');\r\n      success = true;\r\n    } else {\r\n      ElMessage.error('新库位码不匹配');\r\n    }\r\n  }\r\n\r\n  if (success) {\r\n    showScanDialog.value = false;\r\n  } else {\r\n    nextTick(() => {\r\n      scanInputRef.value?.select();\r\n    });\r\n  }\r\n};\r\n\r\nconst clearScanDialog = () => {\r\n  scannedCode.value = '';\r\n};\r\n\r\n// eslint-disable-next-line\r\nconst allStocked = computed(() => {\r\n  if (orderList.length === 0) return false;\r\n  return orderList.every(order => order.status === 'stocked');\r\n});\r\n\r\nconst completeStocking = () => {\r\n  // 打开拍照上传对话框\r\n  showPhotoDialog.value = true;\r\n};\r\n\r\n// 处理照片选择\r\nconst handlePhotoChange = (file) => {\r\n  if (!file) return;\r\n  \r\n  // 检查文件类型\r\n  if (!file.raw.type.startsWith('image/')) {\r\n    ElMessage.error('请上传图片文件');\r\n    return;\r\n  }\r\n  \r\n  // 检查文件大小，限制为5MB\r\n  if (file.size / 1024 / 1024 > 5) {\r\n    ElMessage.error('图片大小不能超过5MB');\r\n    return;\r\n  }\r\n  \r\n  // 创建预览URL\r\n  const url = URL.createObjectURL(file.raw);\r\n  \r\n  // 添加到照片列表\r\n  photoList.value.push({\r\n    file: file.raw,\r\n    url\r\n  });\r\n};\r\n\r\n// 移除照片\r\nconst removePhoto = (index) => {\r\n  // 释放URL占用的资源\r\n  URL.revokeObjectURL(photoList.value[index].url);\r\n  // 从列表中移除\r\n  photoList.value.splice(index, 1);\r\n};\r\n\r\n// 拍照功能\r\nconst takePhoto = async () => {\r\n  showCameraDialog.value = true;\r\n  \r\n  // 延迟初始化摄像头，确保DOM已渲染\r\n  nextTick(() => {\r\n    initCamera();\r\n  });\r\n};\r\n\r\n// 初始化摄像头\r\nconst initCamera = async () => {\r\n  try {\r\n    mediaStream = await navigator.mediaDevices.getUserMedia({ \r\n      video: { facingMode: 'environment' }, // 优先使用后置摄像头\r\n      audio: false \r\n    });\r\n    \r\n    if (videoRef.value) {\r\n      videoRef.value.srcObject = mediaStream;\r\n      hasCamera.value = true;\r\n    }\r\n  } catch (error) {\r\n    console.error('无法访问摄像头:', error);\r\n    hasCamera.value = false;\r\n    ElMessage.error('无法访问摄像头，请检查浏览器权限设置');\r\n  }\r\n};\r\n\r\n// 捕获照片\r\nconst capturePhoto = () => {\r\n  if (!videoRef.value || !mediaStream) return;\r\n  \r\n  // 创建Canvas元素来捕获视频帧\r\n  const canvas = document.createElement('canvas');\r\n  const context = canvas.getContext('2d');\r\n  const video = videoRef.value;\r\n  \r\n  canvas.width = video.videoWidth;\r\n  canvas.height = video.videoHeight;\r\n  \r\n  // 在Canvas上绘制当前视频帧\r\n  context.drawImage(video, 0, 0, canvas.width, canvas.height);\r\n  \r\n  // 将Canvas转换为Blob\r\n  canvas.toBlob((blob) => {\r\n    // 创建预览URL\r\n    const url = URL.createObjectURL(blob);\r\n    \r\n    // 添加到照片列表\r\n    photoList.value.push({\r\n      file: new File([blob], `photo_${Date.now()}.jpg`, { type: 'image/jpeg' }),\r\n      url\r\n    });\r\n    \r\n    // 关闭摄像头对话框\r\n    closeCameraDialog();\r\n  }, 'image/jpeg', 0.95);\r\n};\r\n\r\n// 关闭摄像头对话框\r\nconst closeCameraDialog = () => {\r\n  showCameraDialog.value = false;\r\n  \r\n  // 停止所有视频轨道\r\n  if (mediaStream) {\r\n    mediaStream.getTracks().forEach(track => track.stop());\r\n    mediaStream = null;\r\n  }\r\n};\r\n\r\n// 取消上传照片\r\nconst cancelUpload = () => {\r\n  // 清理资源\r\n  photoList.value.forEach(photo => {\r\n    URL.revokeObjectURL(photo.url);\r\n  });\r\n  photoList.value = [];\r\n  showPhotoDialog.value = false;\r\n};\r\n\r\n// 提交照片\r\nconst submitPhotos = () => {\r\n  if (!photoList.value.length) {\r\n    ElMessage.warning('请至少上传一张凭证照片');\r\n    return;\r\n  }\r\n  \r\n  // 模拟上传\r\n  ElMessage.success({\r\n    message: `成功上传了 ${photoList.value.length} 张凭证照片`,\r\n    duration: 2000\r\n  });\r\n  \r\n  // 关闭对话框\r\n  setTimeout(() => {\r\n    // 清理资源\r\n    photoList.value.forEach(photo => {\r\n      URL.revokeObjectURL(photo.url);\r\n    });\r\n    photoList.value = [];\r\n    showPhotoDialog.value = false;\r\n    \r\n    // 显示完成消息\r\n    ElMessage.success({\r\n      message: `车次 ${trainNumber.value} 备货完成!`,\r\n      duration: 2000\r\n    });\r\n    \r\n    // 可以在这里添加跳转逻辑\r\n  }, 1000);\r\n};\r\n\r\n// 组件卸载时清理资源\r\nonUnmounted(() => {\r\n  // 关闭摄像头\r\n  if (mediaStream) {\r\n    mediaStream.getTracks().forEach(track => track.stop());\r\n  }\r\n  \r\n  // 释放所有照片URL\r\n  photoList.value.forEach(photo => {\r\n    URL.revokeObjectURL(photo.url);\r\n  });\r\n});\r\n\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n/* 外层包裹样式 */\r\n.stocking-view-wrapper {\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  padding: 20px;\r\n  background-color: #f0f2f5;\r\n  min-height: calc(100vh - 104px); // Adjust based on your layout\r\n}\r\n\r\n/* 手机外壳样式 */\r\n.phone-mockup {\r\n  width: 390px;\r\n  height: 844px;\r\n  border: 12px solid black;\r\n  border-radius: 50px;\r\n  background-color: #f9f9f9;\r\n  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);\r\n  position: relative;\r\n  padding: 15px;\r\n  box-sizing: border-box;\r\n\r\n  &::before {\r\n    content: '';\r\n    position: absolute;\r\n    top: 0;\r\n    left: 50%;\r\n    transform: translateX(-50%);\r\n    width: 150px;\r\n    height: 25px;\r\n    background-color: black;\r\n    border-bottom-left-radius: 15px;\r\n    border-bottom-right-radius: 15px;\r\n    z-index: 2;\r\n  }\r\n}\r\n\r\n.phone-screen {\r\n  width: 100%;\r\n  height: 100%;\r\n  background-color: #ffffff;\r\n  border-radius: 38px;\r\n  overflow: hidden;\r\n  display: flex;\r\n  flex-direction: column;\r\n  position: relative;\r\n  z-index: 1;\r\n}\r\n\r\n/* 原 StockingConfirm.vue 的样式，作用于手机屏幕内部 */\r\n.stocking-confirm-container-el {\r\n  display: flex;\r\n  flex-direction: column;\r\n  height: 100%;\r\n  /* background-color: #f0f2f5; */\r\n  border-radius: 38px;\r\n  overflow: hidden; \r\n  position: relative; // Needed for absolute positioning of footer\r\n}\r\n\r\n.el-page-header {\r\n  background-color: #fff;\r\n  padding: 10px 20px;\r\n  // box-shadow: 0 1px 4px rgba(0, 21, 41, 0.08);\r\n  flex-shrink: 0;\r\n  border-bottom: 1px solid #eee;\r\n}\r\n\r\n.train-info-el {\r\n  background-color: #fff;\r\n  padding: 12px; // 减少 padding\r\n  margin: 8px;   // 减少 margin\r\n  border-radius: 4px;\r\n  box-shadow: var(--el-box-shadow-light);\r\n  text-align: center;\r\n  flex-shrink: 0;\r\n\r\n  h2 {\r\n    margin: 0;\r\n    font-size: 16px; // 减小字体\r\n    color: #303133;\r\n  }\r\n}\r\n\r\n.confirm-button-container-el {\r\n  padding: 8px; // 减少 padding\r\n  flex-shrink: 0;\r\n}\r\n\r\n.order-data-area-el {\r\n  flex-grow: 1;\r\n  overflow-y: auto;\r\n  padding: 8px 8px 60px 8px; // 调整 padding, 增加底部 padding 为按钮留空间\r\n}\r\n\r\n.loading-el, .no-data-el {\r\n  text-align: center;\r\n  color: #909399;\r\n  margin-top: 15px;\r\n  font-size: 13px; // 减小字体\r\n}\r\n\r\n.order-card-el {\r\n  margin-bottom: 8px;\r\n  position: relative;\r\n\r\n  &.stocked-el {\r\n    background-color: #f0f9eb;\r\n    border-left: 4px solid var(--el-color-success);\r\n  }\r\n\r\n  :deep(.el-card__body) {\r\n    padding: 10px 12px; // 减少卡片内边距\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    gap: 8px; // 增加内容和按钮间距\r\n  }\r\n}\r\n\r\n.order-details-el {\r\n   flex-grow: 1; // 让详情区域占据更多空间\r\n}\r\n\r\n.order-details-el p {\r\n  margin: 3px 0; // 减少行间距\r\n  font-size: 13px; // 减小字体\r\n  color: #606266;\r\n  line-height: 1.4;\r\n\r\n  strong {\r\n    color: #303133;\r\n    min-width: 60px; // 减小宽度\r\n    display: inline-block;\r\n  }\r\n\r\n  .status-pending-el {\r\n    color: var(--el-color-warning);\r\n    font-weight: bold;\r\n  }\r\n  .status-stocked-el {\r\n    color: var(--el-color-success);\r\n    font-weight: bold;\r\n  }\r\n}\r\n\r\n.scan-actions-el {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 6px; // 减少按钮间距\r\n  align-items: flex-end;\r\n  flex-shrink: 0;\r\n  // margin-left: 10px;\r\n}\r\n\r\n.stocked-indicator-el {\r\n  display: flex;\r\n  align-items: center;\r\n  color: var(--el-color-success);\r\n  font-weight: bold;\r\n  gap: 4px; // 减少间距\r\n  flex-shrink: 0;\r\n //  margin-left: 10px;\r\n   font-size: 13px; // 减小字体\r\n\r\n  .el-icon {\r\n    vertical-align: middle;\r\n    font-size: 16px; // 调整图标大小\r\n  }\r\n}\r\n\r\n/* 将 footer 按钮固定在手机屏幕内部的底部 */\r\n.footer-button-inside-phone {\r\n  position: absolute; // 相对于 .stocking-confirm-container-el 定位\r\n  bottom: 0;\r\n  left: 0;\r\n  right: 0;\r\n  padding: 8px; // 减少 padding\r\n  background-color: #fff;\r\n  box-shadow: 0 -1px 4px rgba(0, 21, 41, 0.08);\r\n  z-index: 10; \r\n  border-bottom-left-radius: 38px; // 匹配屏幕圆角\r\n  border-bottom-right-radius: 38px;\r\n}\r\n\r\n// Dialog 样式保持不变\r\n:deep(.el-dialog__body) {\r\n    padding: 15px 20px;\r\n}\r\n\r\n:deep(.el-dialog__footer) {\r\n     padding: 10px 20px;\r\n     border-top: 1px solid var(--el-border-color-lighter);\r\n}\r\n\r\n/* 照片上传样式 */\r\n.photo-upload-container {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  gap: 15px;\r\n}\r\n\r\n.photo-placeholder {\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: center;\r\n  align-items: center;\r\n  width: 100%;\r\n  height: 200px;\r\n  background-color: #f5f7fa;\r\n  border: 1px dashed #dcdfe6;\r\n  border-radius: 4px;\r\n  \r\n  .el-icon {\r\n    font-size: 48px;\r\n    color: #c0c4cc;\r\n    margin-bottom: 10px;\r\n  }\r\n  \r\n  p {\r\n    color: #909399;\r\n    font-size: 14px;\r\n  }\r\n}\r\n\r\n.photo-preview {\r\n  display: flex;\r\n  flex-wrap: wrap;\r\n  gap: 10px;\r\n  width: 100%;\r\n}\r\n\r\n.photo-item {\r\n  position: relative;\r\n  width: calc(50% - 5px);\r\n  padding-bottom: calc(50% - 5px);\r\n  border-radius: 4px;\r\n  overflow: hidden;\r\n  \r\n  img {\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n    width: 100%;\r\n    height: 100%;\r\n    object-fit: cover;\r\n  }\r\n  \r\n  .photo-delete {\r\n    position: absolute;\r\n    top: 5px;\r\n    right: 5px;\r\n    width: 24px;\r\n    height: 24px;\r\n    background-color: rgba(0, 0, 0, 0.5);\r\n    border-radius: 50%;\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    cursor: pointer;\r\n    \r\n    .el-icon {\r\n      color: #fff;\r\n      font-size: 16px;\r\n    }\r\n  }\r\n}\r\n\r\n.upload-actions {\r\n  display: flex;\r\n  gap: 10px;\r\n  margin-top: 10px;\r\n}\r\n\r\n/* 摄像头样式 */\r\n.camera-container {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  gap: 15px;\r\n}\r\n\r\n.camera-video {\r\n  width: 100%;\r\n  max-height: 50vh;\r\n  background-color: #000;\r\n  border-radius: 4px;\r\n}\r\n\r\n.camera-actions {\r\n  display: flex;\r\n  justify-content: center;\r\n  gap: 10px;\r\n  margin-top: 10px;\r\n}\r\n\r\n.camera-error {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  padding: 20px;\r\n  \r\n  .el-icon {\r\n    font-size: 48px;\r\n    color: #f56c6c;\r\n    margin-bottom: 10px;\r\n  }\r\n  \r\n  p {\r\n    color: #606266;\r\n    text-align: center;\r\n  }\r\n}\r\n\r\n/* 手机外壳的响应式样式 */\r\n@media (max-height: 900px) {\r\n  .phone-mockup {\r\n    transform: scale(0.9);\r\n  }\r\n}\r\n@media (max-width: 450px) {\r\n  .stocking-view-wrapper {\r\n      padding: 10px 0;\r\n  }\r\n   .phone-mockup {\r\n    width: 95%;\r\n    height: auto;\r\n    min-height: 600px;\r\n    max-height: 85vh;\r\n    padding: 10px;\r\n    border-width: 10px;\r\n    border-radius: 40px;\r\n     &::before {\r\n       width: 120px;\r\n       height: 20px;\r\n       border-bottom-left-radius: 12px;\r\n       border-bottom-right-radius: 12px;\r\n    }\r\n  }\r\n   .phone-screen {\r\n      border-radius: 30px;\r\n   }\r\n   .stocking-confirm-container-el {\r\n       border-radius: 30px;\r\n   }\r\n    .footer-button-inside-phone {\r\n       border-bottom-left-radius: 30px;\r\n       border-bottom-right-radius: 30px;\r\n    }\r\n}\r\n</style> ","import script from \"./StockingConfirm.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./StockingConfirm.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./StockingConfirm.vue?vue&type=style&index=0&id=5dbf0c78&scoped=true&lang=scss\"\n\nimport exportComponent from \"../../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-5dbf0c78\"]])\n\nexport default __exports__"],"names":["route","useRoute","router","useRouter","trainId","ref","trainNumber","stockingStarted","orderList","reactive","orderLoading","showScanDialog","scannedCode","scanType","currentScanningOrder","scanInputLabel","scanInputRef","showPhotoDialog","showCameraDialog","photoList","hasCamera","videoRef","uploadRef","mediaStream","onMounted","value","params","ElMessage","error","goBack","back","startStocking","console","log","length","fetchOrderData","async","Promise","resolve","setTimeout","mockData","palletCode","orderNumber","originalLocation","targetLocation","status","processedData","map","order","palletScanned","originalLocationScanned","targetLocationScanned","push","getStatusText","openScanDialog","nextTick","focus","simulateScanPallet","simulateScanOriginalLocation","warning","simulateScanTargetLocation","confirmScan","code","trim","success","select","clearScanDialog","completeStocking","computed","every","handlePhotoChange","file","raw","type","startsWith","size","url","URL","createObjectURL","removePhoto","index","revokeObjectURL","splice","takePhoto","initCamera","navigator","mediaDevices","getUserMedia","video","facingMode","audio","srcObject","capturePhoto","canvas","document","createElement","context","getContext","width","videoWidth","height","videoHeight","drawImage","toBlob","blob","File","Date","now","closeCameraDialog","getTracks","forEach","track","stop","cancelUpload","photo","submitPhotos","message","duration","onUnmounted","__exports__"],"sourceRoot":""}